---
import DocsLayout from '../../layouts/DocsLayout.astro';

const content = "<p>\n> A marketplace for Gas Town formulas\n</p>\n<h2>Vision</h2>\n<strong>Mol Mall</strong> is a registry for sharing formulas across Gas Town installations. Think npm for molecules, or Terraform Registry for workflows.\n<pre><code class=\"language-text\">&quot;Cook a formula, sling it to a polecat, the witness watches, refinery merges.&quot;\n<p>\nWhat if you could browse a mall of formulas, install one, and immediately\nhave your polecats executing world-class workflows?</code></pre>\n</p>\n<h3>The Network Effect</h3>\n<p>\nA well-designed formula for \"code review\" or \"security audit\" or \"deploy to K8s\" can spread across thousands of Gas Town installations. Each adoption means:\n</p>\n<ul><li>More agents executing proven workflows</li>\n<li>More structured, trackable work output</li>\n<li>Better capability routing (agents with track records on a formula get similar work)</li>\n</ul>\n<h2>Architecture</h2>\n<h3>Registry Types</h3>\n<pre><code class=\"language-text\">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n<p>\nâ”‚                      MOL MALL REGISTRIES                         â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n</p>\n<p>\nPUBLIC REGISTRY (molmall.gastown.io)\nâ”œâ”€â”€ Community formulas (MIT licensed)\nâ”œâ”€â”€ Official Gas Town formulas (blessed)\nâ”œâ”€â”€ Verified publisher formulas\nâ””â”€â”€ Open contribution model\n</p>\n<p>\nPRIVATE REGISTRY (self-hosted)\nâ”œâ”€â”€ Organization-specific formulas\nâ”œâ”€â”€ Proprietary workflows\nâ”œâ”€â”€ Internal deployment patterns\nâ””â”€â”€ Enterprise compliance formulas\n</p>\n<p>\nFEDERATED REGISTRY (HOP future)\nâ”œâ”€â”€ Cross-organization discovery\nâ”œâ”€â”€ Skill-based search\nâ””â”€â”€ Attribution chain tracking\nâ””â”€â”€ hop:// URI resolution</code></pre>\n</p>\n<h3>URI Scheme</h3>\n<pre><code class=\"language-text\">hop://molmall.gastown.io/formulas/mol-polecat-work@4.0.0\n<p>\n       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”˜\n           registry host              formula name   version\n</p>\n<h1>Short forms</h1>\n<p>\nmol-polecat-work                    # Default registry, latest version\nmol-polecat-work@4                  # Major version\nmol-polecat-work@4.0.0              # Exact version\n@acme/mol-deploy                    # Scoped to publisher\nhop://acme.corp/formulas/mol-deploy # Full HOP URI</code></pre>\n</p>\n<h3>Registry API</h3>\n<pre><code class=\"language-yaml\"># OpenAPI-style specification\n<p>\nGET /formulas\n  # List all formulas\n  Query:\n    - q: string          # Search query\n    - capabilities: string[]   # Filter by capability tags\n    - author: string     # Filter by author\n    - limit: int\n    - offset: int\n  Response:\n    formulas:\n      - name: mol-polecat-work\n        version: 4.0.0\n        description: &quot;Full polecat work lifecycle...&quot;\n        author: steve@gastown.io\n        downloads: 12543\n        capabilities: [go, testing, code-review]\n</p>\n<p>\nGET /formulas/{name}\n  # Get formula metadata\n  Response:\n    name: mol-polecat-work\n    versions: [4.0.0, 3.2.1, 3.2.0, ...]\n    latest: 4.0.0\n    author: steve@gastown.io\n    repository: https://github.com/steveyegge/gastown\n    license: MIT\n    capabilities:\n      primary: [go, testing]\n      secondary: [git, code-review]\n    stats:\n      downloads: 12543\n      stars: 234\n      used_by: 89  # towns using this formula\n</p>\n<p>\nGET /formulas/{name}/{version}\n  # Get specific version\n  Response:\n    name: mol-polecat-work\n    version: 4.0.0\n    checksum: sha256:abc123...\n    signature: &lt;optional PGP signature&gt;\n    content: &lt;base64 or URL to .formula.toml&gt;\n    changelog: &quot;Added self-cleaning model...&quot;\n    published_at: 2026-01-10T00:00:00Z\n</p>\n<p>\nPOST /formulas\n  # Publish formula (authenticated)\n  Body:\n    name: mol-my-workflow\n    version: 1.0.0\n    content: &lt;formula TOML&gt;\n    changelog: &quot;Initial release&quot;\n  Auth: Bearer token (linked to HOP identity)\n</p>\n<p>\nGET /formulas/{name}/{version}/download\n  # Download formula content\n  Response: raw .formula.toml content</code></pre>\n</p>\n<h2>Formula Package Format</h2>\n<h3>Simple Case: Single File</h3>\n<p>\nMost formulas are single <code>.formula.toml</code> files:\n</p>\n<pre><code class=\"language-bash\">gt formula install mol-polecat-code-review\n<h1>Downloads mol-polecat-code-review.formula.toml to ~/gt/.beads/formulas/</code></pre></h1>\n<h3>Complex Case: Formula Bundle</h3>\n<p>\nSome formulas need supporting files (scripts, templates, configs):\n</p>\n<pre><code class=\"language-text\">mol-deploy-k8s.formula.bundle/\n<p>\nâ”œâ”€â”€ formula.toml              # Main formula\nâ”œâ”€â”€ templates/\nâ”‚   â”œâ”€â”€ deployment.yaml.tmpl\nâ”‚   â””â”€â”€ service.yaml.tmpl\nâ”œâ”€â”€ scripts/\nâ”‚   â””â”€â”€ healthcheck.sh\nâ””â”€â”€ README.md</code></pre>\n</p>\n<p>\nBundle format:\n</p>\n<pre><code class=\"language-bash\"># Bundles are tarballs\n<p>\nmol-deploy-k8s-1.0.0.bundle.tar.gz</code></pre>\n</p>\n<p>\nInstallation:\n</p>\n<pre><code class=\"language-bash\">gt formula install mol-deploy-k8s\n<h1>Extracts to ~/gt/.beads/formulas/mol-deploy-k8s/</h1>\n<h1>formula.toml is at mol-deploy-k8s/formula.toml</code></pre></h1>\n<h2>Installation Flow</h2>\n<h3>Basic Install</h3>\n<pre><code class=\"language-bash\">$ gt formula install mol-polecat-code-review\n<p>\nResolving mol-polecat-code-review...\n  Registry: molmall.gastown.io\n  Version:  1.2.0 (latest)\n  Author:   steve@gastown.io\n  Skills:   code-review, security\n</p>\n<p>\nDownloading... â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%\nVerifying checksum... âœ“\n</p>\n<p>\nInstalled to: ~/gt/.beads/formulas/mol-polecat-code-review.formula.toml</code></pre>\n</p>\n<h3>Version Pinning</h3>\n<pre><code class=\"language-bash\">$ gt formula install mol-polecat-work@4.0.0\n<p>\nInstalling mol-polecat-work@4.0.0 (pinned)...\nâœ“ Installed\n</p>\n<p>\n$ gt formula list --installed\n  mol-polecat-work           4.0.0   [pinned]\n  mol-polecat-code-review    1.2.0   [latest]</code></pre>\n</p>\n<h3>Upgrade Flow</h3>\n<pre><code class=\"language-bash\">$ gt formula upgrade mol-polecat-code-review\n<p>\nChecking for updates...\n  Current: 1.2.0\n  Latest:  1.3.0\n</p>\n<p>\nChangelog for 1.3.0:\n  - Added security focus option\n  - Improved test coverage step\n</p>\n<p>\nUpgrade? [y/N] y\n</p>\n<p>\nDownloading... âœ“\nInstalled: mol-polecat-code-review@1.3.0</code></pre>\n</p>\n<h3>Lock File</h3>\n<pre><code class=\"language-json\">// ~/gt/.beads/formulas/.lock.json\n<p>\n{\n  &quot;version&quot;: 1,\n  &quot;formulas&quot;: {\n    &quot;mol-polecat-work&quot;: {\n      &quot;version&quot;: &quot;4.0.0&quot;,\n      &quot;pinned&quot;: true,\n      &quot;checksum&quot;: &quot;sha256:abc123...&quot;,\n      &quot;installed_at&quot;: &quot;2026-01-10T00:00:00Z&quot;,\n      &quot;source&quot;: &quot;hop://molmall.gastown.io/formulas/mol-polecat-work@4.0.0&quot;\n    },\n    &quot;mol-polecat-code-review&quot;: {\n      &quot;version&quot;: &quot;1.3.0&quot;,\n      &quot;pinned&quot;: false,\n      &quot;checksum&quot;: &quot;sha256:def456...&quot;,\n      &quot;installed_at&quot;: &quot;2026-01-10T12:00:00Z&quot;,\n      &quot;source&quot;: &quot;hop://molmall.gastown.io/formulas/mol-polecat-code-review@1.3.0&quot;\n    }\n  }\n}</code></pre>\n</p>\n<h2>Publishing Flow</h2>\n<h3>First-Time Setup</h3>\n<pre><code class=\"language-bash\">$ gt formula publish --init\n<p>\nSetting up Mol Mall publishing...\n</p>\n<p>\n1. Create account at https://molmall.gastown.io/signup\n2. Generate API token at https://molmall.gastown.io/settings/tokens\n3. Run: gt formula login\n</p>\n<p>\n$ gt formula login\nToken: *****<em><strong>\nLogged in as: steve@gastown.io</code></pre>\n</p>\n<h3>Publishing</h3>\n<pre><code class=\"language-bash\">$ gt formula publish mol-polecat-work\n<p>\nPublishing mol-polecat-work...\n</p>\n<p>\nPre-flight checks:\n  âœ“ formula.toml is valid\n  âœ“ Version 4.0.0 not yet published\n  âœ“ Required fields present (name, version, description)\n  âœ“ Skills declared\n</p>\n<p>\nPublish to molmall.gastown.io? [y/N] y\n</p>\n<p>\nUploading... âœ“\nPublished: hop://molmall.gastown.io/formulas/mol-polecat-work@4.0.0\n</p>\n<p>\nView at: https://molmall.gastown.io/formulas/mol-polecat-work</code></pre>\n</p>\n<h3>Verification Levels</h3>\n<pre><code class=\"language-text\">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n<p>\nâ”‚                    FORMULA TRUST LEVELS                          â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n</p>\n<p>\nUNVERIFIED (default)\n  Anyone can publish\n  Basic validation only\n  Displayed with âš ï¸ warning\n</p>\n<p>\nVERIFIED PUBLISHER\n  Publisher identity confirmed\n  Displayed with âœ“ checkmark\n  Higher search ranking\n</p>\n<p>\nOFFICIAL\n  Maintained by Gas Town team\n  Displayed with ğŸ›ï¸ badge\n  Included in embedded defaults\n</p>\n<p>\nAUDITED\n  Security review completed\n  Displayed with ğŸ”’ badge\n  Required for enterprise registries</code></pre>\n</p>\n<h2>Capability Tagging</h2>\n<h3>Formula Capability Declaration</h3>\n<pre><code class=\"language-toml\">[formula.capabilities]\n<h1>What capabilities does this formula exercise? Used for agent routing.</h1>\n<p>\nprimary = [&quot;go&quot;, &quot;testing&quot;, &quot;code-review&quot;]\nsecondary = [&quot;git&quot;, &quot;ci-cd&quot;]\n</p>\n<h1>Capability weights (optional, for fine-grained routing)</h1>\n<p>\n[formula.capabilities.weights]\ngo = 0.3           # 30% of formula work is Go\ntesting = 0.4      # 40% is testing\ncode-review = 0.3  # 30% is code review</code></pre>\n</p>\n<h3>Capability-Based Search</h3>\n<pre><code class=\"language-bash\">$ gt formula search --capabilities=&quot;security,go&quot;\n<p>\nFormulas matching capabilities: security, go\n</p>\n<p>\n  mol-security-audit           v2.1.0   â­ 4.8   ğŸ“¥ 8,234\n    Capabilities: security, go, code-review\n    &quot;Comprehensive security audit workflow&quot;\n</p>\n<p>\n  mol-dependency-scan          v1.0.0   â­ 4.2   ğŸ“¥ 3,102\n    Capabilities: security, go, supply-chain\n    &quot;Scan Go dependencies for vulnerabilities&quot;</code></pre>\n</p>\n<h3>Agent Accountability</h3>\n<p>\nWhen a polecat completes a formula, the execution is tracked:\n</p>\n<pre><code class=\"language-text\">Polecat: beads/amber\n<p>\nFormula: mol-polecat-code-review@1.3.0\nCompleted: 2026-01-10T15:30:00Z\nCapabilities exercised:\n  - code-review (primary)\n  - security (secondary)\n  - go (secondary)</code></pre>\n</p>\n<p>\nThis execution record enables:\n1. </strong>Routing<strong> - Agents with successful track records get similar work\n2. </strong>Debugging<strong> - Trace which agent did what, when\n3. </strong>Quality metrics</em>* - Track success rates by agent and formula\n</p>\n<h2>Private Registries</h2>\n<h3>Enterprise Deployment</h3>\n<pre><code class=\"language-yaml\"># ~/.gtconfig.yaml\n<p>\nregistries:\n  - name: acme\n    url: https://molmall.acme.corp\n    auth: token\n    priority: 1  # Check first\n</p>\n<p>\n  - name: public\n    url: https://molmall.gastown.io\n    auth: none\n    priority: 2  # Fallback</code></pre>\n</p>\n<h3>Self-Hosted Registry</h3>\n<pre><code class=\"language-bash\"># Docker deployment\n<p>\ndocker run -d \\\n  -p 8080:8080 \\\n  -v /data/formulas:/formulas \\\n  -e AUTH_PROVIDER=oidc \\\n  gastown/molmall-registry:latest\n</p>\n<h1>Configuration</h1>\n<p>\nMOLMALL_STORAGE=s3://bucket/formulas\nMOLMALL_AUTH=oidc\nMOLMALL_OIDC_ISSUER=https://auth.acme.corp</code></pre>\n</p>\n<h2>Federation</h2>\n<p>\nFederation enables formula sharing across organizations using the Highway Operations Protocol (HOP).\n</p>\n<h3>Cross-Registry Discovery</h3>\n<pre><code class=\"language-bash\">$ gt formula search &quot;deploy kubernetes&quot; --federated\n<p>\nSearching across federated registries...\n</p>\n<p>\n  molmall.gastown.io:\n    mol-deploy-k8s           v3.0.0   ğŸ›ï¸ Official\n</p>\n<p>\n  molmall.acme.corp:\n    @acme/mol-deploy-k8s     v2.1.0   âœ“ Verified\n</p>\n<p>\n  molmall.bigco.io:\n    @bigco/k8s-workflow      v1.0.0   âš ï¸ Unverified</code></pre>\n</p>\n<h3>HOP URI Resolution</h3>\n<p>\nThe <code>hop://</code> URI scheme provides cross-registry entity references:\n</p>\n<pre><code class=\"language-bash\"># Full HOP URI\n<p>\ngt formula install hop://molmall.acme.corp/formulas/@acme/mol-deploy@2.1.0\n</p>\n<h1>Resolution via HOP (Highway Operations Protocol)</h1>\n<p>\n1. Parse hop:// URI\n2. Resolve registry endpoint (DNS/HOP discovery)\n3. Authenticate (if required)\n4. Download formula\n5. Verify checksum/signature\n6. Install to town-level</code></pre>\n</p>\n<h2>Implementation Phases</h2>\n<h3>Phase 1: Local Commands (Now)</h3>\n<ul><li><code>gt formula list</code> with tier display</li>\n<li><code>gt formula show --resolve</code></li>\n<li>Formula resolution order (project â†’ town â†’ system)</li>\n</ul>\n<h3>Phase 2: Manual Sharing</h3>\n<ul><li>Formula export/import</li>\n<li><code>gt formula export mol-polecat-work > mol-polecat-work.formula.toml</code></li>\n<li><code>gt formula import < mol-polecat-work.formula.toml</code></li>\n<li>Lock file format</li>\n</ul>\n<h3>Phase 3: Public Registry</h3>\n<ul><li>molmall.gastown.io launch</li>\n<li><code>gt formula install</code> from registry</li>\n<li><code>gt formula publish</code> flow</li>\n<li>Basic search and browse</li>\n</ul>\n<h3>Phase 4: Enterprise Features</h3>\n<ul><li>Private registry support</li>\n<li>Authentication integration</li>\n<li>Verification levels</li>\n<li>Audit logging</li>\n</ul>\n<h3>Phase 5: Federation (HOP)</h3>\n<ul><li>Capability tags in schema</li>\n<li>Federation protocol (Highway Operations Protocol)</li>\n<li>Cross-registry search</li>\n<li>Agent execution tracking for accountability</li>\n</ul>\n<h2>Related Documents</h2>\n<ul><li><a href=\"formula-resolution.md\">Formula Resolution</a> - Local resolution order</li>\n<li><a href=\"molecules.md\">molecules.md</a> - Formula lifecycle (cook, pour, squash)</li>\n<li><a href=\"../../../docs/understanding-gas-town.md\">understanding-gas-town.md</a> - Gas Town architecture</li></ul>";
---

<DocsLayout title="Mol Mall Design" description="> A marketplace for Gas Town formulas">
  <div class="markdown-content" set:html={content} />
</DocsLayout>
