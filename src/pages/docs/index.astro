---
import DocsLayout from '../../layouts/DocsLayout.astro';

const content = "<p>\nThis document provides a conceptual overview of Gas Town's architecture, focusing on\nthe role taxonomy and how different agents interact.\n</p>\n<h2>Why Gas Town Exists</h2>\n<p>\nAs AI agents become central to engineering workflows, teams face new challenges:\n</p>\n<ul><li><strong>Accountability:</strong> Who did what? Which agent introduced this bug?</li>\n<li><strong>Quality:</strong> Which agents are reliable? Which need tuning?</li>\n<li><strong>Efficiency:</strong> How do you route work to the right agent?</li>\n<li><strong>Scale:</strong> How do you coordinate agents across repos and teams?</li>\n</ul>\n<p>\nGas Town is an orchestration layer that treats AI agent work as structured data.\nEvery action is attributed. Every agent has a track record. Every piece of work\nhas provenance. See <a href=\"/docs/why-these-features\">Why These Features</a> for the full rationale.\n</p>\n<h2>Role Taxonomy</h2>\n<p>\nGas Town has several agent types, each with distinct responsibilities and lifecycles.\n</p>\n<h3>Infrastructure Roles</h3>\n<p>\nThese roles manage the Gas Town system itself:\n</p>\n<table><tr><td>Role</td><td>Description</td><td>Lifecycle</td></tr>\n</table>\n<table><tr><td><strong>Mayor</strong></td><td>Global coordinator at mayor/</td><td>Singleton, persistent</td></tr>\n<tr><td><strong>Deacon</strong></td><td>Background supervisor daemon (<a href=\"/docs/design/watchdog-chain\">watchdog chain</a>)</td><td>Singleton, persistent</td></tr>\n<tr><td><strong>Witness</strong></td><td>Per-rig polecat lifecycle manager</td><td>One per rig, persistent</td></tr>\n<tr><td><strong>Refinery</strong></td><td>Per-rig merge queue processor</td><td>One per rig, persistent</td></tr>\n</table>\n<h3>Worker Roles</h3>\n<p>\nThese roles do actual project work:\n</p>\n<table><tr><td>Role</td><td>Description</td><td>Lifecycle</td></tr>\n</table>\n<table><tr><td><strong>Polecat</strong></td><td>Ephemeral worker with own worktree</td><td>Transient, Witness-managed (<a href=\"/docs/concepts/polecat-lifecycle\">details</a>)</td></tr>\n<tr><td><strong>Crew</strong></td><td>Persistent worker with own clone</td><td>Long-lived, user-managed</td></tr>\n<tr><td><strong>Dog</strong></td><td>Deacon helper for infrastructure tasks</td><td>Ephemeral, Deacon-managed</td></tr>\n</table>\n<h2>Convoys: Tracking Work</h2>\n<p>\nA <strong>convoy</strong> (ðŸšš) is how you track batched work in Gas Town. When you kick off work -\neven a single issue - create a convoy to track it.\n</p>\n<p>\n<pre><code class=\"language-bash\"># Create a convoy tracking some issues\ngt convoy create &quot;Feature X&quot; gt-abc gt-def --notify overseer\n\n# Check progress\ngt convoy status hq-cv-abc\n\n# Dashboard of active convoys\ngt convoy list</code></pre>\n</p>\n<strong>Why convoys matter:</strong>\n<ul><li>Single view of \"what's in flight\"</li>\n<li>Cross-rig tracking (convoy in hq-<em>, issues in gt-</em>, bd-*)</li>\n<li>Auto-notification when work lands</li>\n<li>Historical record of completed work (<code>gt convoy list --all</code>)</li>\n</ul>\n<p>\nThe \"swarm\" is ephemeral - just the workers currently assigned to a convoy's issues.\nWhen issues close, the convoy lands. See <a href=\"/docs/concepts/convoy\">Convoys</a> for details.\n</p>\n<h2>Crew vs Polecats</h2>\n<p>\nBoth do project work, but with key differences:\n</p>\n<table><tr><td>Aspect</td><td>Crew</td><td>Polecat</td></tr>\n</table>\n<table><tr><td><strong>Lifecycle</strong></td><td>Persistent (user controls)</td><td>Transient (Witness controls)</td></tr>\n<tr><td><strong>Monitoring</strong></td><td>None</td><td>Witness watches, nudges, recycles</td></tr>\n<tr><td><strong>Work assignment</strong></td><td>Human-directed or self-assigned</td><td>Slung via <code>gt sling</code></td></tr>\n<tr><td><strong>Git state</strong></td><td>Pushes to main directly</td><td>Works on branch, Refinery merges</td></tr>\n<tr><td><strong>Cleanup</strong></td><td>Manual</td><td>Automatic on completion</td></tr>\n<tr><td><strong>Identity</strong></td><td><code>&lt;rig&gt;/crew/&lt;name&gt;</code></td><td><code>&lt;rig&gt;/polecats/&lt;name&gt;</code></td></tr>\n</table>\n<strong>When to use Crew</strong>:\n<ul><li>Exploratory work</li>\n<li>Long-running projects</li>\n<li>Work requiring human judgment</li>\n<li>Tasks where you want direct control</li>\n</ul>\n<strong>When to use Polecats</strong>:\n<ul><li>Discrete, well-defined tasks</li>\n<li>Batch work (tracked via convoys)</li>\n<li>Parallelizable work</li>\n<li>Work that benefits from supervision</li>\n</ul>\n<h2>Dogs vs Crew</h2>\n<strong>Dogs are NOT workers</strong>. This is a common misconception.\n<table><tr><td>Aspect</td><td>Dogs</td><td>Crew</td></tr>\n</table>\n<table><tr><td><strong>Owner</strong></td><td>Deacon</td><td>Human</td></tr>\n<tr><td><strong>Purpose</strong></td><td>Infrastructure tasks</td><td>Project work</td></tr>\n<tr><td><strong>Scope</strong></td><td>Narrow, focused utilities</td><td>General purpose</td></tr>\n<tr><td><strong>Lifecycle</strong></td><td>Very short (single task)</td><td>Long-lived</td></tr>\n<tr><td><strong>Example</strong></td><td>Boot (triages Deacon health)</td><td>Joe (fixes bugs, adds features)</td></tr>\n</table>\n<p>\nDogs are the Deacon's helpers for system-level tasks:\n</p>\n<ul><li><strong>Boot</strong>: Triages Deacon health on daemon tick</li>\n<li>Future dogs might handle: log rotation, health checks, etc.</li>\n</ul>\n<p>\nIf you need to do work in another rig, use <strong>worktrees</strong>, not dogs.\n</p>\n<h2>Cross-Rig Work Patterns</h2>\n<p>\nWhen a crew member needs to work on another rig:\n</p>\n<h3>Option 1: Worktrees (Preferred)</h3>\n<p>\nCreate a worktree in the target rig:\n</p>\n<p>\n<pre><code class=\"language-bash\"># gastown/crew/joe needs to fix a beads bug\ngt worktree beads\n# Creates ~/gt/beads/crew/gastown-joe/\n# Identity preserved: BD_ACTOR = gastown/crew/joe</code></pre>\n</p>\n<p>\nDirectory structure:\n<pre><code class=\"language-text\">~/gt/beads/crew/gastown-joe/     # joe from gastown working on beads\n~/gt/gastown/crew/beads-wolf/    # wolf from beads working on gastown</code></pre>\n</p>\n<h3>Option 2: Dispatch to Local Workers</h3>\n<p>\nFor work that should be owned by the target rig:\n</p>\n<p>\n<pre><code class=\"language-bash\"># Create issue in target rig\nbd create --prefix beads &quot;Fix authentication bug&quot;\n\n# Create convoy and sling to target rig\ngt convoy create &quot;Auth fix&quot; bd-xyz\ngt sling bd-xyz beads</code></pre>\n</p>\n<h3>When to Use Which</h3>\n<table><tr><td>Scenario</td><td>Approach</td></tr>\n</table>\n<table><tr><td>You need to fix something quick</td><td>Worktree</td></tr>\n<tr><td>Work should appear in your CV</td><td>Worktree</td></tr>\n<tr><td>Work should be done by target rig team</td><td>Dispatch</td></tr>\n<tr><td>Infrastructure/system task</td><td>Let Deacon handle it</td></tr>\n</table>\n<h2>Directory Structure</h2>\n<p>\n<pre><code class=\"language-text\">~/gt/                           Town root\nâ”œâ”€â”€ .beads/                     Town-level beads (hq-* prefix, mail)\nâ”œâ”€â”€ mayor/                      Mayor config\nâ”‚   â””â”€â”€ town.json\nâ”œâ”€â”€ deacon/                     Deacon daemon\nâ”‚   â””â”€â”€ dogs/                   Deacon helpers (NOT workers)\nâ”‚       â””â”€â”€ boot/               Health triage dog\nâ””â”€â”€ &lt;rig&gt;/                      Project container\n    â”œâ”€â”€ config.json             Rig identity\n    â”œâ”€â”€ .beads/ â†’ mayor/rig/.beads  (symlink or redirect)\n    â”œâ”€â”€ .repo.git/              Bare repo (shared by worktrees)\n    â”œâ”€â”€ mayor/rig/              Mayor's clone (canonical beads)\n    â”œâ”€â”€ refinery/rig/           Worktree on main\n    â”œâ”€â”€ witness/                No clone (monitors only)\n    â”œâ”€â”€ crew/                   Persistent human workspaces\n    â”‚   â”œâ”€â”€ joe/                Local crew member\n    â”‚   â””â”€â”€ beads-wolf/         Cross-rig worktree (wolf from beads)\n    â””â”€â”€ polecats/               Ephemeral worker worktrees\n        â””â”€â”€ Toast/              Individual polecat</code></pre>\n</p>\n<h2>Identity and Attribution</h2>\n<p>\nAll work is attributed to the actor who performed it:\n</p>\n<p>\n<pre><code class=\"language-text\">Git commits:      Author: gastown/crew/joe &lt;owner@example.com&gt;\nBeads issues:     created_by: gastown/crew/joe\nEvents:           actor: gastown/crew/joe</code></pre>\n</p>\n<p>\nIdentity is preserved even when working cross-rig:\n</p>\n<ul><li><code>gastown/crew/joe</code> working in <code>~/gt/beads/crew/gastown-joe/</code></li>\n<li>Commits still attributed to <code>gastown/crew/joe</code></li>\n<li>Work appears on joe's CV, not beads rig's workers</li>\n</ul>\n<h2>The Propulsion Principle</h2>\n<p>\nAll Gas Town agents follow the same core principle:\n</p>\n<p>\n> <strong>If you find something on your hook, YOU RUN IT.</strong>\n</p>\n<p>\nThis applies regardless of role. The hook is your assignment. Execute it immediately\nwithout waiting for confirmation. Gas Town is a steam engine - agents are pistons.\n</p>\n<h2>Model Evaluation and A/B Testing</h2>\n<p>\nGas Town's attribution and work history features enable objective model comparison:\n</p>\n<p>\n<pre><code class=\"language-bash\"># Deploy different models on similar tasks\ngt sling gt-abc gastown --model=claude-sonnet\ngt sling gt-def gastown --model=gpt-4\n\n# Compare outcomes\nbd stats --actor=gastown/polecats/* --group-by=model</code></pre>\n</p>\n<p>\nBecause every task has completion time, quality signals, and revision count,\nyou can make data-driven decisions about which models to deploy where.\n</p>\n<p>\nThis is particularly valuable for:\n</p>\n<ul><li><strong>Model selection:</strong> Which model handles your codebase best?</li>\n<li><strong>Capability mapping:</strong> Claude for architecture, GPT for tests?</li>\n<li><strong>Cost optimization:</strong> When is a smaller model sufficient?</li>\n</ul>\n<h2>Common Mistakes</h2>\n<ol><li><strong>Using dogs for user work</strong>: Dogs are Deacon infrastructure. Use crew or polecats.</li>\n<li><strong>Confusing crew with polecats</strong>: Crew is persistent and human-managed. Polecats are transient and Witness-managed.</li>\n<li><strong>Working in wrong directory</strong>: Gas Town uses cwd for identity detection. Stay in your home directory.</li>\n<li><strong>Waiting for confirmation when work is hooked</strong>: The hook IS your assignment. Execute immediately.</li>\n<li><strong>Creating worktrees when dispatch is better</strong>: If work should be owned by the target rig, dispatch it instead.</li></ol>";
---

<DocsLayout title="Understanding Gas Town" description="This document provides a conceptual overview of Gas Town's architecture, focusing on the role taxonomy and how different agents interact.">
  <div class="markdown-content" set:html={content} />
</DocsLayout>
