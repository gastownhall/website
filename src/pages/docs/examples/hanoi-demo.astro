---
import DocsLayout from '../../../layouts/DocsLayout.astro';

const content = "<p>\nA durability proof demonstrating Gas Town's ability to execute arbitrarily long\nsequential workflows with crash recovery and session cycling.\n</p>\n<h2>What This Proves</h2>\n<p>\n1. <strong>Large Molecule Creation</strong>: Creating 1000+ issues in a single workflow\n2. <strong>Sequential Execution</strong>: Dependencies chain properly across many steps\n3. <strong>Crash Recovery</strong>: Work resumes correctly after session restart\n4. <strong>Nondeterministic Idempotence</strong>: Different sessions, same outcome\n</p>\n<h2>The Math</h2>\n<p>\nTowers of Hanoi requires <code>2^n - 1</code> moves for <code>n</code> disks:\n</p>\n<table><tr><td>Disks</td><td>Moves</td><td>Formula Size</td><td>Est. Runtime</td></tr>\n</table>\n<table><tr><td>7</td><td>127</td><td>~19 KB</td><td>~14 sec</td></tr>\n<tr><td>9</td><td>511</td><td>~74 KB</td><td>~1 min</td></tr>\n<tr><td>10</td><td>1,023</td><td>~149 KB</td><td>~2 min</td></tr>\n<tr><td>15</td><td>32,767</td><td>~4.7 MB</td><td>~1 hour</td></tr>\n<tr><td>20</td><td>1M+</td><td>~163 MB</td><td>~30 hours</td></tr>\n</table>\n<h2>Pre-Generated Formulas</h2>\n<p>\nLocated in <code>.beads/formulas/</code>:\n</p>\n<ul><li><code>towers-of-hanoi-7.formula.toml</code> - 127 moves (quick test)</li>\n<li><code>towers-of-hanoi-9.formula.toml</code> - 511 moves (medium test)</li>\n<li><code>towers-of-hanoi-10.formula.toml</code> - 1023 moves (standard demo)</li>\n</ul>\n<h2>Running the Demo</h2>\n<h3>Quick Test (7 disks, ~14 seconds)</h3>\n<pre><code class=\"language-bash\"># Create wisp\n<p>\nbd mol wisp towers-of-hanoi-7 --json | jq -r '.new_epic_id'\n</p>\n<h1>Returns: gt-eph-xxx</h1>\n<h1>Get all child IDs</h1>\n<p>\nbd list --parent=gt-eph-xxx --limit=200 --json | jq -r '.[].id' &gt; /tmp/ids.txt\n</p>\n<h1>Close all issues (serial)</h1>\n<p>\nwhile read id; do bd --no-daemon close &quot;$id&quot; &gt;/dev/null; done &lt; /tmp/ids.txt\n</p>\n<h1>Burn the wisp (cleanup)</h1>\n<p>\nbd mol burn gt-eph-xxx --force</code></pre>\n</p>\n<h3>Standard Demo (10 disks, ~2 minutes)</h3>\n<pre><code class=\"language-bash\"># Create wisp\n<p>\nWISP=$(bd mol wisp towers-of-hanoi-10 --json | jq -r '.new_epic_id')\necho &quot;Created wisp: $WISP&quot;\n</p>\n<h1>Get all 1025 child IDs (1023 moves + setup + verify)</h1>\n<p>\nbd list --parent=$WISP --limit=2000 --json | jq -r '.[].id' &gt; /tmp/ids.txt\nwc -l /tmp/ids.txt  # Should show 1025\n</p>\n<h1>Time the execution</h1>\n<p>\nSTART=$(date +%s)\nwhile read id; do bd --no-daemon close &quot;$id&quot; &gt;/dev/null 2&gt;&amp;1; done &lt; /tmp/ids.txt\nEND=$(date +%s)\necho &quot;Completed in $((END - START)) seconds&quot;\n</p>\n<h1>Verify completion</h1>\n<p>\nbd list --parent=$WISP --status=open  # Should be empty\n</p>\n<h1>Cleanup</h1>\n<p>\nbd mol burn $WISP --force</code></pre>\n</p>\n<h2>Why Wisps?</h2>\n<p>\nThe demo uses wisps (ephemeral molecules) because:\n</p>\n<p>\n1. <strong>No Git Pollution</strong>: Wisps don't sync to JSONL, keeping git history clean\n2. <strong>Auto-Cleanup</strong>: Wisps can be burned without leaving tombstones\n3. <strong>Speed</strong>: No export overhead during rapid closes\n4. <strong>Appropriate Semantics</strong>: This is operational testing, not auditable work\n</p>\n<h2>Key Insights</h2>\n<h3><code>bd ready</code> Excludes Wisps</h3>\n<p>\nBy design, <code>bd ready</code> filters out ephemeral issues:\n</p>\n<pre><code class=\"language-go\">&quot;(i.ephemeral = 0 OR i.ephemeral IS NULL)&quot;, // Exclude wisps</code></pre>\n<p>\nFor wisp execution, query children directly:\n</p>\n<pre><code class=\"language-bash\">bd list --parent=$WISP --status=open</code></pre>\n<h3>Dependencies Work Correctly</h3>\n<p>\nEach move depends on the previous one via <code>needs</code>:\n</p>\n<pre><code class=\"language-toml\">[[steps]]\n<p>\nid = &quot;move-42&quot;\nneeds = [&quot;move-41&quot;]</code></pre>\n</p>\n<p>\nThis creates proper <code>blocks</code> dependencies. Parent-child relationships\nprovide hierarchy only - they don't block execution.\n</p>\n<h3>Close Speed</h3>\n<p>\nWith <code>bd --no-daemon close</code>:\n</p>\n<ul><li>~109ms per close (serial)</li>\n<li>~9 closes/second</li>\n</ul>\n<p>\nParallelization would improve throughput but requires careful\ndependency ordering.\n</p>\n<h2>Generating Larger Formulas</h2>\n<p>\nUse the generator script:\n</p>\n<pre><code class=\"language-bash\"># Generate 15-disk formula (32K moves)\n<p>\npython3 scripts/gen_hanoi.py 15 &gt; .beads/formulas/towers-of-hanoi-15.formula.toml</code></pre>\n</p>\n<strong>Warning</strong>: 20-disk formula is ~163MB and creates 1M+ issues. Only for\n<p>\nstress testing post-launch.\n</p>\n<h2>Monitoring Progress</h2>\n<p>\nFor long-running executions:\n</p>\n<pre><code class=\"language-bash\"># Count closed issues\n<p>\nbd list --parent=$WISP --status=closed --json | jq 'length'\n</p>\n<h1>Count remaining</h1>\n<p>\nbd list --parent=$WISP --status=open --json | jq 'length'\n</p>\n<h1>Progress percentage</h1>\n<p>\nTOTAL=1025\nCLOSED=$(bd list --parent=$WISP --status=closed --limit=2000 --json | jq 'length')\necho &quot;$CLOSED / $TOTAL = $((CLOSED * 100 / TOTAL))%&quot;</code></pre>\n</p>\n<h2>Session Cycling</h2>\n<p>\nThe beauty of this demo: you can stop at any time and resume later.\n</p>\n<pre><code class=\"language-bash\"># Session 1: Start the wisp, close some issues\n<p>\nWISP=$(bd mol wisp towers-of-hanoi-10 --json | jq -r '.new_epic_id')\n</p>\n<h1>... close some issues ...</h1>\n<h1>Context fills, need to cycle</h1>\n<p>\ngt handoff -s &quot;Hanoi demo&quot; -m &quot;Wisp: $WISP, progress: 400/1025&quot;</code></pre>\n</p>\n<pre><code class=\"language-bash\"># Session 2: Resume where you left off\n<h1>(Read handoff mail for wisp ID)</h1>\n<p>\nbd list --parent=$WISP --status=open --limit=2000 --json | jq -r '.[].id' &gt; /tmp/ids.txt\n</p>\n<h1>... continue closing ...</code></pre></h1>\n<p>\nThe molecule IS the state. No memory of previous session needed.\n</p>";
---

<DocsLayout title="Towers of Hanoi Demo" description="A durability proof demonstrating Gas Town's ability to execute arbitrarily long sequential workflows with crash recovery and session cycling.">
  <div class="markdown-content" set:html={content} />
</DocsLayout>
