---
import DocsLayout from '../../../layouts/DocsLayout.astro';

const content = "<p>\nA durability proof demonstrating Gas Town's ability to execute arbitrarily long\nsequential workflows with crash recovery and session cycling.\n</p>\n<h2>What This Proves</h2>\n<ol><li><strong>Large Molecule Creation</strong>: Creating 1000+ issues in a single workflow</li>\n<li><strong>Sequential Execution</strong>: Dependencies chain properly across many steps</li>\n<li><strong>Crash Recovery</strong>: Work resumes correctly after session restart</li>\n<li><strong>Nondeterministic Idempotence</strong>: Different sessions, same outcome</li>\n</ol>\n<h2>The Math</h2>\n<p>\nTowers of Hanoi requires <code>2^n - 1</code> moves for <code>n</code> disks:\n</p>\n<table><tr><td>Disks</td><td>Moves</td><td>Formula Size</td><td>Est. Runtime</td></tr>\n</table>\n<table><tr><td>7</td><td>127</td><td>~19 KB</td><td>~14 sec</td></tr>\n<tr><td>9</td><td>511</td><td>~74 KB</td><td>~1 min</td></tr>\n<tr><td>10</td><td>1,023</td><td>~149 KB</td><td>~2 min</td></tr>\n<tr><td>15</td><td>32,767</td><td>~4.7 MB</td><td>~1 hour</td></tr>\n<tr><td>20</td><td>1M+</td><td>~163 MB</td><td>~30 hours</td></tr>\n</table>\n<h2>Pre-Generated Formulas</h2>\n<p>\nLocated in <code>.beads/formulas/</code>:\n</p>\n<ul><li><code>towers-of-hanoi-7.formula.toml</code> - 127 moves (quick test)</li>\n<li><code>towers-of-hanoi-9.formula.toml</code> - 511 moves (medium test)</li>\n<li><code>towers-of-hanoi-10.formula.toml</code> - 1023 moves (standard demo)</li>\n</ul>\n<h2>Running the Demo</h2>\n<h3>Quick Test (7 disks, ~14 seconds)</h3>\n<p>\n<pre><code class=\"language-bash\"># Create wisp\nbd mol wisp towers-of-hanoi-7 --json | jq -r '.new_epic_id'\n# Returns: gt-eph-xxx\n\n# Get all child IDs\nbd list --parent=gt-eph-xxx --limit=200 --json | jq -r '.[].id' &gt; /tmp/ids.txt\n\n# Close all issues (serial)\nwhile read id; do bd --no-daemon close &quot;$id&quot; &gt;/dev/null; done &lt; /tmp/ids.txt\n\n# Burn the wisp (cleanup)\nbd mol burn gt-eph-xxx --force</code></pre>\n</p>\n<h3>Standard Demo (10 disks, ~2 minutes)</h3>\n<p>\n<pre><code class=\"language-bash\"># Create wisp\nWISP=$(bd mol wisp towers-of-hanoi-10 --json | jq -r '.new_epic_id')\necho &quot;Created wisp: $WISP&quot;\n\n# Get all 1025 child IDs (1023 moves + setup + verify)\nbd list --parent=$WISP --limit=2000 --json | jq -r '.[].id' &gt; /tmp/ids.txt\nwc -l /tmp/ids.txt  # Should show 1025\n\n# Time the execution\nSTART=$(date +%s)\nwhile read id; do bd --no-daemon close &quot;$id&quot; &gt;/dev/null 2&gt;&amp;1; done &lt; /tmp/ids.txt\nEND=$(date +%s)\necho &quot;Completed in $((END - START)) seconds&quot;\n\n# Verify completion\nbd list --parent=$WISP --status=open  # Should be empty\n\n# Cleanup\nbd mol burn $WISP --force</code></pre>\n</p>\n<h2>Why Wisps?</h2>\n<p>\nThe demo uses wisps (ephemeral molecules) because:\n</p>\n<ol><li><strong>No Git Pollution</strong>: Wisps don't sync to JSONL, keeping git history clean</li>\n<li><strong>Auto-Cleanup</strong>: Wisps can be burned without leaving tombstones</li>\n<li><strong>Speed</strong>: No export overhead during rapid closes</li>\n<li><strong>Appropriate Semantics</strong>: This is operational testing, not auditable work</li>\n</ol>\n<h2>Key Insights</h2>\n<h3><code>bd ready</code> Excludes Wisps</h3>\n<p>\nBy design, <code>bd ready</code> filters out ephemeral issues:\n<pre><code class=\"language-go\">&quot;(i.ephemeral = 0 OR i.ephemeral IS NULL)&quot;, // Exclude wisps</code></pre>\n</p>\n<p>\nFor wisp execution, query children directly:\n<pre><code class=\"language-bash\">bd list --parent=$WISP --status=open</code></pre>\n</p>\n<h3>Dependencies Work Correctly</h3>\n<p>\nEach move depends on the previous one via <code>needs</code>:\n<pre><code class=\"language-toml\">[[steps]]\nid = &quot;move-42&quot;\nneeds = [&quot;move-41&quot;]</code></pre>\n</p>\n<p>\nThis creates proper <code>blocks</code> dependencies. Parent-child relationships\nprovide hierarchy only - they don't block execution.\n</p>\n<h3>Close Speed</h3>\n<p>\nWith <code>bd --no-daemon close</code>:\n</p>\n<ul><li>~109ms per close (serial)</li>\n<li>~9 closes/second</li>\n</ul>\n<p>\nParallelization would improve throughput but requires careful\ndependency ordering.\n</p>\n<h2>Generating Larger Formulas</h2>\n<p>\nUse the generator script:\n</p>\n<p>\n<pre><code class=\"language-bash\"># Generate 15-disk formula (32K moves)\npython3 scripts/gen_hanoi.py 15 &gt; .beads/formulas/towers-of-hanoi-15.formula.toml</code></pre>\n</p>\n<strong>Warning</strong>: 20-disk formula is ~163MB and creates 1M+ issues. Only for\n<p>\nstress testing post-launch.\n</p>\n<h2>Monitoring Progress</h2>\n<p>\nFor long-running executions:\n</p>\n<p>\n<pre><code class=\"language-bash\"># Count closed issues\nbd list --parent=$WISP --status=closed --json | jq 'length'\n\n# Count remaining\nbd list --parent=$WISP --status=open --json | jq 'length'\n\n# Progress percentage\nTOTAL=1025\nCLOSED=$(bd list --parent=$WISP --status=closed --limit=2000 --json | jq 'length')\necho &quot;$CLOSED / $TOTAL = $((CLOSED * 100 / TOTAL))%&quot;</code></pre>\n</p>\n<h2>Session Cycling</h2>\n<p>\nThe beauty of this demo: you can stop at any time and resume later.\n</p>\n<p>\n<pre><code class=\"language-bash\"># Session 1: Start the wisp, close some issues\nWISP=$(bd mol wisp towers-of-hanoi-10 --json | jq -r '.new_epic_id')\n# ... close some issues ...\n# Context fills, need to cycle\n\ngt handoff -s &quot;Hanoi demo&quot; -m &quot;Wisp: $WISP, progress: 400/1025&quot;</code></pre>\n</p>\n<p>\n<pre><code class=\"language-bash\"># Session 2: Resume where you left off\n# (Read handoff mail for wisp ID)\nbd list --parent=$WISP --status=open --limit=2000 --json | jq -r '.[].id' &gt; /tmp/ids.txt\n# ... continue closing ...</code></pre>\n</p>\n<p>\nThe molecule IS the state. No memory of previous session needed.\n</p>";
---

<DocsLayout title="Towers of Hanoi Demo" description="A durability proof demonstrating Gas Town's ability to execute arbitrarily long sequential workflows with crash recovery and session cycling.">
  <div class="markdown-content" set:html={content} />
</DocsLayout>
