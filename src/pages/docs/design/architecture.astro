---
import DocsLayout from '../../../layouts/DocsLayout.astro';

const content = "<p>\nTechnical architecture for Gas Town multi-agent workspace management.\n</p>\n<h2>Two-Level Beads Architecture</h2>\n<p>\nGas Town uses a two-level beads architecture to separate organizational coordination\nfrom project implementation work.\n</p>\n<table><tr><td>Level</td><td>Location</td><td>Prefix</td><td>Purpose</td></tr>\n</table>\n<table><tr><td><strong>Town</strong></td><td><code>~/gt/.beads/</code></td><td><code>hq-*</code></td><td>Cross-rig coordination, Mayor mail, agent identity</td></tr>\n<tr><td><strong>Rig</strong></td><td><code>&lt;rig&gt;/mayor/rig/.beads/</code></td><td>project prefix</td><td>Implementation work, MRs, project issues</td></tr>\n</table>\n<h3>Town-Level Beads (<code>~/gt/.beads/</code>)</h3>\n<p>\nOrganizational chain for cross-rig coordination:\n</p>\n<ul><li>Mayor mail and messages</li>\n<li>Convoy coordination (batch work across rigs)</li>\n<li>Strategic issues and decisions</li>\n<li><strong>Town-level agent beads</strong> (Mayor, Deacon)</li>\n<li><strong>Role definition beads</strong> (global templates)</li>\n</ul>\n<h3>Rig-Level Beads (<code>&lt;rig&gt;/mayor/rig/.beads/</code>)</h3>\n<p>\nProject chain for implementation work:\n</p>\n<ul><li>Bugs, features, tasks for the project</li>\n<li>Merge requests and code reviews</li>\n<li>Project-specific molecules</li>\n<li><strong>Rig-level agent beads</strong> (Witness, Refinery, Polecats)</li>\n</ul>\n<h2>Agent Bead Storage</h2>\n<p>\nAgent beads track lifecycle state for each agent. Storage location depends on\nthe agent's scope.\n</p>\n<table><tr><td>Agent Type</td><td>Scope</td><td>Bead Location</td><td>Bead ID Format</td></tr>\n</table>\n<table><tr><td>Mayor</td><td>Town</td><td><code>~/gt/.beads/</code></td><td><code>hq-mayor</code></td></tr>\n<tr><td>Deacon</td><td>Town</td><td><code>~/gt/.beads/</code></td><td><code>hq-deacon</code></td></tr>\n<tr><td>Dogs</td><td>Town</td><td><code>~/gt/.beads/</code></td><td><code>hq-dog-&lt;name&gt;</code></td></tr>\n<tr><td>Witness</td><td>Rig</td><td><code>&lt;rig&gt;/.beads/</code></td><td><code>&lt;prefix&gt;-&lt;rig&gt;-witness</code></td></tr>\n<tr><td>Refinery</td><td>Rig</td><td><code>&lt;rig&gt;/.beads/</code></td><td><code>&lt;prefix&gt;-&lt;rig&gt;-refinery</code></td></tr>\n<tr><td>Polecats</td><td>Rig</td><td><code>&lt;rig&gt;/.beads/</code></td><td><code>&lt;prefix&gt;-&lt;rig&gt;-polecat-&lt;name&gt;</code></td></tr>\n</table>\n<h3>Role Beads</h3>\n<p>\nRole beads are global templates stored in town beads with <code>hq-</code> prefix:\n</p>\n<ul><li><code>hq-mayor-role</code> - Mayor role definition</li>\n<li><code>hq-deacon-role</code> - Deacon role definition</li>\n<li><code>hq-witness-role</code> - Witness role definition</li>\n<li><code>hq-refinery-role</code> - Refinery role definition</li>\n<li><code>hq-polecat-role</code> - Polecat role definition</li>\n</ul>\n<p>\nEach agent bead references its role bead via the <code>role_bead</code> field.\n</p>\n<h2>Agent Taxonomy</h2>\n<h3>Town-Level Agents (Cross-Rig)</h3>\n<table><tr><td>Agent</td><td>Role</td><td>Persistence</td></tr>\n</table>\n<table><tr><td><strong>Mayor</strong></td><td>Global coordinator, handles cross-rig communication and escalations</td><td>Persistent</td></tr>\n<tr><td><strong>Deacon</strong></td><td>Daemon beacon - receives heartbeats, runs plugins and monitoring</td><td>Persistent</td></tr>\n<tr><td><strong>Dogs</strong></td><td>Long-running workers for cross-rig batch work</td><td>Variable</td></tr>\n</table>\n<h3>Rig-Level Agents (Per-Project)</h3>\n<table><tr><td>Agent</td><td>Role</td><td>Persistence</td></tr>\n</table>\n<table><tr><td><strong>Witness</strong></td><td>Monitors polecat health, handles nudging and cleanup</td><td>Persistent</td></tr>\n<tr><td><strong>Refinery</strong></td><td>Processes merge queue, runs verification</td><td>Persistent</td></tr>\n<tr><td><strong>Polecats</strong></td><td>Ephemeral workers assigned to specific issues</td><td>Ephemeral</td></tr>\n</table>\n<h2>Directory Structure</h2>\n<p>\n<pre><code class=\"language-text\">~/gt/                           Town root\n├── .beads/                     Town-level beads (hq-* prefix)\n│   ├── config.yaml             Beads configuration\n│   ├── issues.jsonl            Town issues (mail, agents, convoys)\n│   └── routes.jsonl            Prefix → rig routing table\n├── mayor/                      Mayor config\n│   └── town.json               Town configuration\n└── &lt;rig&gt;/                      Project container (NOT a git clone)\n    ├── config.json             Rig identity and beads prefix\n    ├── mayor/rig/              Canonical clone (beads live here)\n    │   └── .beads/             Rig-level beads database\n    ├── refinery/rig/           Worktree from mayor/rig\n    ├── witness/                No clone (monitors only)\n    ├── crew/&lt;name&gt;/            Human workspaces (full clones)\n    └── polecats/&lt;name&gt;/        Worker worktrees from mayor/rig</code></pre>\n</p>\n<h3>Worktree Architecture</h3>\n<p>\nPolecats and refinery are git worktrees, not full clones. This enables fast spawning\nand shared object storage. The worktree base is <code>mayor/rig</code>:\n</p>\n<p>\n<pre><code class=\"language-go\">// From polecat/manager.go - worktrees are based on mayor/rig\ngit worktree add -b polecat/&lt;name&gt;-&lt;timestamp&gt; polecats/&lt;name&gt;</code></pre>\n</p>\n<p>\nCrew workspaces (<code>crew/&lt;name&gt;/</code>) are full git clones for human developers who need\nindependent repos. Polecats are ephemeral and benefit from worktree efficiency.\n</p>\n<h2>Beads Routing</h2>\n<p>\nThe <code>routes.jsonl</code> file maps issue ID prefixes to rig locations (relative to town root):\n</p>\n<p>\n<pre><code class=\"language-jsonl\">{&quot;prefix&quot;:&quot;hq-&quot;,&quot;path&quot;:&quot;.&quot;}\n{&quot;prefix&quot;:&quot;gt-&quot;,&quot;path&quot;:&quot;gastown/mayor/rig&quot;}\n{&quot;prefix&quot;:&quot;bd-&quot;,&quot;path&quot;:&quot;beads/mayor/rig&quot;}</code></pre>\n</p>\n<p>\nRoutes point to <code>mayor/rig</code> because that's where the canonical <code>.beads/</code> lives.\nThis enables transparent cross-rig beads operations:\n</p>\n<p>\n<pre><code class=\"language-bash\">bd show hq-mayor    # Routes to town beads (~/.gt/.beads)\nbd show gt-xyz      # Routes to gastown/mayor/rig/.beads</code></pre>\n</p>\n<h2>See Also</h2>\n<ul><li><a href=\"/docs/reference\">Reference</a> - Command reference</li>\n<li><a href=\"/docs/concepts/molecules\">Molecules</a> - Workflow molecules</li>\n<li><a href=\"/docs/concepts/identity\">Identity</a> - Agent identity and BD_ACTOR</li></ul>";
---

<DocsLayout title="Gas Town Architecture" description="Technical architecture for Gas Town multi-agent workspace management.">
  <div class="markdown-content" set:html={content} />
</DocsLayout>
