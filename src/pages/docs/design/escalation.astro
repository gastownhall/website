---
import DocsLayout from '../../../layouts/DocsLayout.astro';

const content = "<p>\n> Reference for escalation paths in Gas Town\n</p>\n<h2>Overview</h2>\n<p>\nGas Town agents can escalate issues when automated resolution isn't possible.\nThis document covers:\n</p>\n<ul><li>Severity levels and routing</li>\n<li>Escalation categories for structured communication</li>\n<li>Tiered escalation (Deacon -> Mayor -> Overseer)</li>\n<li>Decision patterns for async resolution</li>\n<li>Integration with gates and patrol lifecycles</li>\n</ul>\n<h2>Severity Levels</h2>\n<table><tr><td>Level</td><td>Priority</td><td>Description</td><td>Examples</td></tr>\n</table>\n<table><tr><td><strong>CRITICAL</strong></td><td>P0 (urgent)</td><td>System-threatening, immediate attention</td><td>Data corruption, security breach, system down</td></tr>\n<tr><td><strong>HIGH</strong></td><td>P1 (high)</td><td>Important blocker, needs human soon</td><td>Unresolvable merge conflict, critical bug, ambiguous spec</td></tr>\n<tr><td><strong>MEDIUM</strong></td><td>P2 (normal)</td><td>Standard escalation, human at convenience</td><td>Design decision needed, unclear requirements</td></tr>\n</table>\n<h2>Escalation Categories</h2>\n<p>\nCategories provide structured routing based on the nature of the escalation:\n</p>\n<table><tr><td>Category</td><td>Description</td><td>Default Route</td></tr>\n</table>\n<table><tr><td><code>decision</code></td><td>Multiple valid paths, need choice</td><td>Deacon -> Mayor</td></tr>\n<tr><td><code>help</code></td><td>Need guidance or expertise</td><td>Deacon -> Mayor</td></tr>\n<tr><td><code>blocked</code></td><td>Waiting on unresolvable dependency</td><td>Mayor</td></tr>\n<tr><td><code>failed</code></td><td>Unexpected error, can't proceed</td><td>Deacon</td></tr>\n<tr><td><code>emergency</code></td><td>Security or data integrity issue</td><td>Overseer (direct)</td></tr>\n<tr><td><code>gate_timeout</code></td><td>Gate didn't resolve in time</td><td>Deacon</td></tr>\n<tr><td><code>lifecycle</code></td><td>Worker stuck or needs recycle</td><td>Witness</td></tr>\n</table>\n<h2>Escalation Command</h2>\n<h3>Basic Usage (unchanged)</h3>\n<pre><code class=\"language-bash\"># Basic escalation (default: MEDIUM severity)\n<p>\ngt escalate &quot;Database migration failed&quot;\n</p>\n<h1>Critical escalation - immediate attention</h1>\n<p>\ngt escalate -s CRITICAL &quot;Data corruption detected in user table&quot;\n</p>\n<h1>High priority escalation</h1>\n<p>\ngt escalate -s HIGH &quot;Merge conflict cannot be resolved automatically&quot;\n</p>\n<h1>With additional details</h1>\n<p>\ngt escalate -s MEDIUM &quot;Need clarification on API design&quot; -m &quot;Details...&quot;</code></pre>\n</p>\n<h3>Category-Based Escalation</h3>\n<pre><code class=\"language-bash\"># Decision needed - routes to Deacon first\n<p>\ngt escalate --type decision &quot;Which auth approach?&quot;\n</p>\n<h1>Help request</h1>\n<p>\ngt escalate --type help &quot;Need architecture guidance&quot;\n</p>\n<h1>Blocked on dependency</h1>\n<p>\ngt escalate --type blocked &quot;Waiting on bd-xyz&quot;\n</p>\n<h1>Failure that can't be recovered</h1>\n<p>\ngt escalate --type failed &quot;Tests failing unexpectedly&quot;\n</p>\n<h1>Emergency - direct to Overseer</h1>\n<p>\ngt escalate --type emergency &quot;Security vulnerability found&quot;</code></pre>\n</p>\n<h3>Tiered Routing</h3>\n<pre><code class=\"language-bash\"># Explicit routing to specific tier\n<p>\ngt escalate --to deacon &quot;Infra issue&quot;\ngt escalate --to mayor &quot;Cross-rig coordination needed&quot;\ngt escalate --to overseer &quot;Human judgment required&quot;\n</p>\n<h1>Forward from one tier to next</h1>\n<p>\ngt escalate --forward --to mayor &quot;Deacon couldn't resolve&quot;</code></pre>\n</p>\n<h3>Structured Decisions</h3>\n<p>\nFor decisions requiring explicit choices:\n</p>\n<pre><code class=\"language-bash\">gt escalate --type decision \\\n<p>\n  --question &quot;Which authentication approach?&quot; \\\n  --options &quot;JWT tokens,Session cookies,OAuth2&quot; \\\n  --context &quot;Admin panel needs login&quot; \\\n  --issue bd-xyz</code></pre>\n</p>\n<p>\nThis updates the issue with a structured decision format (see below).\n</p>\n<h2>What Happens on Escalation</h2>\n<p>\n1. <strong>Bead created/updated</strong>: Escalation bead (tagged <code>escalation</code>) created or updated\n2. <strong>Mail sent</strong>: Routed to appropriate tier (Deacon, Mayor, or Overseer)\n3. <strong>Activity logged</strong>: Event logged to activity feed\n4. <strong>Issue updated</strong>: For decision type, issue gets structured format\n</p>\n<h2>Tiered Escalation Flow</h2>\n<pre><code class=\"language-text\">Worker encounters issue\n<p>\n    |\n    v\ngt escalate --type &lt;category&gt; [--to &lt;tier&gt;]\n    |\n    v\n[Deacon receives] (default for most categories)\n    |\n    +-- Can resolve? --&gt; Updates issue, re-slings work\n    |\n    +-- Cannot resolve? --&gt; gt escalate --forward --to mayor\n                                |\n                                v\n                           [Mayor receives]\n                                |\n                                +-- Can resolve? --&gt; Updates issue, re-slings\n                                |\n                                +-- Cannot resolve? --&gt; gt escalate --forward --to overseer\n                                                            |\n                                                            v\n                                                       [Overseer resolves]</code></pre>\n</p>\n<p>\nEach tier can resolve OR forward. The escalation chain is tracked via comments.\n</p>\n<h2>Decision Pattern</h2>\n<p>\nWhen <code>--type decision</code> is used, the issue is updated with structured format:\n</p>\n<pre><code class=\"language-markdown\">## Decision Needed\n<strong>Question:</strong> Which authentication approach?\n<table><tr><td>Option</td><td>Description</td></tr>\n</table>\n<table><tr><td>A</td><td>JWT tokens</td></tr>\n<tr><td>B</td><td>Session cookies</td></tr>\n<tr><td>C</td><td>OAuth2</td></tr>\n</table>\n<strong>Context:</strong> Admin panel needs login\n<strong>Escalated by:</strong> beads/polecats/obsidian\n<strong>Escalated at:</strong> 2026-01-01T15:00:00Z\n<strong>To resolve:</strong>\n<p>\n1. Comment with chosen option (e.g., &quot;Decision: A&quot;)\n2. Reassign to work queue or original worker</code></pre>\n</p>\n<p>\nThe issue becomes the async communication channel. Resolution updates the issue\nand can trigger re-slinging to the original worker.\n</p>\n<h2>Integration Points</h2>\n<h3>Gate Timeouts</h3>\n<p>\nWhen timer gates expire (see bd-7zka.2), Witness escalates:\n</p>\n<pre><code class=\"language-go\">if gate.Expired() {\n<p>\n    exec.Command(&quot;gt&quot;, &quot;escalate&quot;,\n        &quot;--type&quot;, &quot;gate_timeout&quot;,\n        &quot;--severity&quot;, &quot;HIGH&quot;,\n        &quot;--issue&quot;, gate.BlockedIssueID,\n        fmt.Sprintf(&quot;Gate %s timed out after %s&quot;, gate.ID, gate.Timeout)).Run()\n}</code></pre>\n</p>\n<h3>Witness Patrol</h3>\n<p>\nWitness formalizes stuck-polecat detection as escalation:\n</p>\n<pre><code class=\"language-go\">exec.Command(&quot;gt&quot;, &quot;escalate&quot;,\n<p>\n    &quot;--type&quot;, &quot;lifecycle&quot;,\n    &quot;--to&quot;, &quot;mayor&quot;,\n    &quot;--issue&quot;, polecat.CurrentIssue,\n    fmt.Sprintf(&quot;Polecat %s stuck: no progress for %d minutes&quot;, polecat.ID, minutes)).Run()</code></pre>\n</p>\n<h3>Refinery</h3>\n<p>\nOn merge failures that can't be auto-resolved:\n</p>\n<pre><code class=\"language-go\">exec.Command(&quot;gt&quot;, &quot;escalate&quot;,\n<p>\n    &quot;--type&quot;, &quot;failed&quot;,\n    &quot;--issue&quot;, mr.IssueID,\n    &quot;Merge failed: &quot;+reason).Run()</code></pre>\n</p>\n<h2>Polecat Exit with Escalation</h2>\n<p>\nWhen a polecat needs a decision to continue:\n</p>\n<pre><code class=\"language-bash\"># 1. Update issue with decision structure\n<p>\nbd update $ISSUE --notes &quot;$(cat &lt;&lt;EOF\n</p>\n<h2>Decision Needed</h2>\n<strong>Question:</strong> Which approach for caching?\n<table><tr><td>Option</td><td>Description</td></tr>\n</table>\n<table><tr><td>A</td><td>Redis (external dependency)</td></tr>\n<tr><td>B</td><td>In-memory (simpler, no persistence)</td></tr>\n<tr><td>C</td><td>SQLite (local persistence)</td></tr>\n</table>\n<strong>Context:</strong> API response times are slow, need caching layer.\n<p>\nEOF\n)&quot;\n</p>\n<h1>2. Escalate</h1>\n<p>\ngt escalate --type decision --issue $ISSUE &quot;Caching approach needs decision&quot;\n</p>\n<h1>3. Exit cleanly</h1>\n<p>\ngt done --status ESCALATED</code></pre>\n</p>\n<h2>Mayor Startup Check</h2>\n<p>\nOn <code>gt prime</code>, Mayor checks for pending escalations:\n</p>\n<pre><code class=\"language-text\">## PENDING ESCALATIONS\n<p>\nThere are 3 escalation(s) awaiting attention:\n</p>\n<p>\n  CRITICAL: 1\n  HIGH: 1\n  MEDIUM: 1\n</p>\n<p>\n  [CRITICAL] Data corruption detected (gt-abc)\n  [HIGH] Merge conflict in auth module (gt-def)\n  [MEDIUM] API design clarification needed (gt-ghi)\n</p>\n<strong>Action required:</strong> Review escalations with <code>bd list --tag=escalation</code>\n<p>\nClose resolved ones with <code>bd close &lt;id&gt; --reason &quot;resolution&quot;</code></code></pre>\n</p>\n<h2>When to Escalate</h2>\n<h3>Agents SHOULD escalate when:</h3>\n<ul><li><strong>System errors</strong>: Database corruption, disk full, network failures</li>\n<li><strong>Security issues</strong>: Unauthorized access attempts, credential exposure</li>\n<li><strong>Unresolvable conflicts</strong>: Merge conflicts that can't be auto-resolved</li>\n<li><strong>Ambiguous requirements</strong>: Spec is unclear, multiple valid interpretations</li>\n<li><strong>Design decisions</strong>: Architectural choices that need human judgment</li>\n<li><strong>Stuck loops</strong>: Agent is stuck and can't make progress</li>\n<li><strong>Gate timeouts</strong>: Async conditions didn't resolve in expected time</li>\n</ul>\n<h3>Agents should NOT escalate for:</h3>\n<ul><li><strong>Normal workflow</strong>: Regular work that can proceed without human input</li>\n<li><strong>Recoverable errors</strong>: Transient failures that will auto-retry</li>\n<li><strong>Information queries</strong>: Questions that can be answered from context</li>\n</ul>\n<h2>Viewing Escalations</h2>\n<pre><code class=\"language-bash\"># List all open escalations\n<p>\nbd list --status=open --tag=escalation\n</p>\n<h1>Filter by category</h1>\n<p>\nbd list --tag=escalation --tag=decision\n</p>\n<h1>View specific escalation</h1>\n<p>\nbd show &lt;escalation-id&gt;\n</p>\n<h1>Close resolved escalation</h1>\n<p>\nbd close &lt;id&gt; --reason &quot;Resolved by fixing X&quot;</code></pre>\n</p>\n<h2>Implementation Phases</h2>\n<h3>Phase 1: Extend gt escalate</h3>\n<ul><li>Add <code>--type</code> flag for categories</li>\n<li>Add <code>--to</code> flag for routing (deacon, mayor, overseer)</li>\n<li>Add <code>--forward</code> flag for tier forwarding</li>\n<li>Backward compatible with existing usage</li>\n</ul>\n<h3>Phase 2: Decision Pattern</h3>\n<ul><li>Add <code>--question</code>, <code>--options</code>, <code>--context</code> flags</li>\n<li>Auto-update issue with decision structure</li>\n<li>Parse decision from issue comments on resolution</li>\n</ul>\n<h3>Phase 3: Gate Integration</h3>\n<ul><li>Add <code>gate_timeout</code> escalation type</li>\n<li>Witness checks timer gates, escalates on timeout</li>\n<li>Refinery checks GH gates, escalates on timeout/failure</li>\n</ul>\n<h3>Phase 4: Patrol Integration</h3>\n<ul><li>Formalize Witness stuck-polecat as escalation</li>\n<li>Formalize Refinery merge-failure as escalation</li>\n<li>Unified escalation handling in Mayor</li>\n</ul>\n<h2>References</h2>\n<ul><li>bd-7zka.2: Gate evaluation (uses escalation for timeouts)</li>\n<li>bd-0sgd: Design issue for this extended escalation system</li></ul>";
---

<DocsLayout title="Gas Town Escalation Protocol" description="> Reference for escalation paths in Gas Town">
  <div class="markdown-content" set:html={content} />
</DocsLayout>
