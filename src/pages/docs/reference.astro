---
import DocsLayout from '../../layouts/DocsLayout.astro';

const content = "<p>\nTechnical reference for Gas Town internals. Read the README first.\n</p>\n<h2>Directory Structure</h2>\n<p>\n<pre><code class=\"language-text\">~/gt/                           Town root\nâ”œâ”€â”€ .beads/                     Town-level beads (hq-* prefix)\nâ”œâ”€â”€ mayor/                      Mayor agent home (town coordinator)\nâ”‚   â”œâ”€â”€ town.json               Town configuration\nâ”‚   â”œâ”€â”€ CLAUDE.md               Mayor context (on disk)\nâ”‚   â””â”€â”€ .claude/settings.json   Mayor Claude settings\nâ”œâ”€â”€ deacon/                     Deacon agent home (background supervisor)\nâ”‚   â””â”€â”€ .claude/settings.json   Deacon settings (context via gt prime)\nâ””â”€â”€ &lt;rig&gt;/                      Project container (NOT a git clone)\n    â”œâ”€â”€ config.json             Rig identity\n    â”œâ”€â”€ .beads/ â†’ mayor/rig/.beads\n    â”œâ”€â”€ .repo.git/              Bare repo (shared by worktrees)\n    â”œâ”€â”€ mayor/rig/              Mayor's clone (canonical beads)\n    â”‚   â””â”€â”€ CLAUDE.md           Per-rig mayor context (on disk)\n    â”œâ”€â”€ witness/                Witness agent home (monitors only)\n    â”‚   â””â”€â”€ .claude/settings.json  (context via gt prime)\n    â”œâ”€â”€ refinery/               Refinery settings parent\n    â”‚   â”œâ”€â”€ .claude/settings.json\n    â”‚   â””â”€â”€ rig/                Worktree on main\n    â”‚       â””â”€â”€ CLAUDE.md       Refinery context (on disk)\n    â”œâ”€â”€ crew/                   Crew settings parent (shared)\n    â”‚   â”œâ”€â”€ .claude/settings.json  (context via gt prime)\n    â”‚   â””â”€â”€ &lt;name&gt;/rig/         Human workspaces\n    â””â”€â”€ polecats/               Polecat settings parent (shared)\n        â”œâ”€â”€ .claude/settings.json  (context via gt prime)\n        â””â”€â”€ &lt;name&gt;/rig/         Worker worktrees</code></pre>\n</p>\n<strong>Key points:</strong>\n<ul><li>Rig root is a container, not a clone</li>\n<li><code>.repo.git/</code> is bare - refinery and polecats are worktrees</li>\n<li>Per-rig <code>mayor/rig/</code> holds canonical <code>.beads/</code>, others inherit via redirect</li>\n<li>Settings placed in parent dirs (not git clones) for upward traversal</li>\n</ul>\n<h2>Beads Routing</h2>\n<p>\nGas Town routes beads commands based on issue ID prefix. You don't need to think\nabout which database to use - just use the issue ID.\n</p>\n<p>\n<pre><code class=\"language-bash\">bd show gp-xyz    # Routes to greenplace rig's beads\nbd show hq-abc    # Routes to town-level beads\nbd show wyv-123   # Routes to wyvern rig's beads</code></pre>\n</p>\n<strong>How it works</strong>: Routes are defined in <code>~/gt/.beads/routes.jsonl</code>. Each rig's\n<p>\nprefix maps to its beads location (the mayor's clone in that rig).\n</p>\n<table><tr><td>Prefix</td><td>Routes To</td><td>Purpose</td></tr>\n</table>\n<table><tr><td><code>hq-*</code></td><td><code>~/gt/.beads/</code></td><td>Mayor mail, cross-rig coordination</td></tr>\n<tr><td><code>gp-*</code></td><td><code>~/gt/greenplace/mayor/rig/.beads/</code></td><td>Greenplace project issues</td></tr>\n<tr><td><code>wyv-*</code></td><td><code>~/gt/wyvern/mayor/rig/.beads/</code></td><td>Wyvern project issues</td></tr>\n</table>\n<p>\nDebug routing: <code>BD_DEBUG_ROUTING=1 bd show &lt;id&gt;</code>\n</p>\n<h2>Configuration</h2>\n<h3>Rig Config (<code>config.json</code>)</h3>\n<p>\n<pre><code class=\"language-json\">{\n  &quot;type&quot;: &quot;rig&quot;,\n  &quot;name&quot;: &quot;myproject&quot;,\n  &quot;git_url&quot;: &quot;https://github.com/...&quot;,\n  &quot;beads&quot;: { &quot;prefix&quot;: &quot;mp&quot; }\n}</code></pre>\n</p>\n<h3>Settings (<code>settings/config.json</code>)</h3>\n<p>\n<pre><code class=\"language-json\">{\n  &quot;theme&quot;: &quot;desert&quot;,\n  &quot;max_workers&quot;: 5,\n  &quot;merge_queue&quot;: { &quot;enabled&quot;: true }\n}</code></pre>\n</p>\n<h3>Runtime (<code>.runtime/</code> - gitignored)</h3>\n<p>\nProcess state, PIDs, ephemeral data.\n</p>\n<h2>Formula Format</h2>\n<p>\n<pre><code class=\"language-toml\">formula = &quot;name&quot;\ntype = &quot;workflow&quot;           # workflow | expansion | aspect\nversion = 1\ndescription = &quot;...&quot;\n\n[vars.feature]\ndescription = &quot;...&quot;\nrequired = true\n\n[[steps]]\nid = &quot;step-id&quot;\ntitle = &quot;{{feature}}&quot;\ndescription = &quot;...&quot;\nneeds = [&quot;other-step&quot;]      # Dependencies</code></pre>\n</p>\n<strong>Composition:</strong>\n<p>\n<pre><code class=\"language-toml\">extends = [&quot;base-formula&quot;]\n\n[compose]\naspects = [&quot;cross-cutting&quot;]\n\n[[compose.expand]]\ntarget = &quot;step-id&quot;\nwith = &quot;macro-formula&quot;</code></pre>\n</p>\n<h2>Molecule Lifecycle</h2>\n<p>\n<pre><code class=\"language-text\">Formula (source TOML) â”€â”€â”€ &quot;Ice-9&quot;\n    â”‚\n    â–¼ bd cook\nProtomolecule (frozen template) â”€â”€â”€ Solid\n    â”‚\n    â”œâ”€â–¶ bd mol pour â”€â”€â–¶ Mol (persistent) â”€â”€â”€ Liquid â”€â”€â–¶ bd squash â”€â”€â–¶ Digest\n    â”‚\n    â””â”€â–¶ bd mol wisp â”€â”€â–¶ Wisp (ephemeral) â”€â”€â”€ Vapor â”€â”€â”¬â–¶ bd squash â”€â”€â–¶ Digest\n                                                  â””â–¶ bd burn â”€â”€â–¶ (gone)</code></pre>\n</p>\n<strong>Note</strong>: Wisps are stored in <code>.beads/</code> with an ephemeral flag - they're not\n<p>\npersisted to JSONL. They exist only in memory during execution.\n</p>\n<h2>Molecule Commands</h2>\n<strong>Principle</strong>: <code>bd</code> = beads data operations, <code>gt</code> = agent operations.\n<h3>Beads Operations (bd)</h3>\n<p>\n<pre><code class=\"language-bash\"># Formulas\nbd formula list              # Available formulas\nbd formula show &lt;name&gt;       # Formula details\nbd cook &lt;formula&gt;            # Formula â†’ Proto\n\n# Molecules (data operations)\nbd mol list                  # Available protos\nbd mol show &lt;id&gt;             # Proto details\nbd mol pour &lt;proto&gt;          # Create mol\nbd mol wisp &lt;proto&gt;          # Create wisp\nbd mol bond &lt;proto&gt; &lt;parent&gt; # Attach to existing mol\nbd mol squash &lt;id&gt;           # Condense to digest (explicit ID)\nbd mol burn &lt;id&gt;             # Discard wisp (explicit ID)</code></pre>\n</p>\n<h3>Agent Operations (gt)</h3>\n<p>\n<pre><code class=\"language-bash\"># Hook management (operates on current agent's hook)\ngt hook                    # What's on MY hook\ngt mol current               # What should I work on next\ngt mol progress &lt;id&gt;         # Execution progress of molecule\ngt mol attach &lt;bead&gt; &lt;mol&gt;   # Pin molecule to bead\ngt mol detach &lt;bead&gt;         # Unpin molecule from bead\ngt mol attach-from-mail &lt;id&gt; # Attach from mail message\n\n# Agent lifecycle (operates on agent's attached molecule)\ngt mol burn                  # Burn attached molecule (no ID needed)\ngt mol squash                # Squash attached molecule (no ID needed)\ngt mol step done &lt;step&gt;      # Complete a molecule step</code></pre>\n</p>\n<strong>Key distinction</strong>: <code>bd mol burn/squash &lt;id&gt;</code> take explicit molecule IDs.\n<p>\n<code>gt mol burn/squash</code> operate on the current agent's attached molecule\n(auto-detected from working directory).\n</p>\n<h2>Agent Lifecycle</h2>\n<h3>Polecat Shutdown</h3>\n<p>\n<pre><code class=\"language-text\">1. Complete work steps\n2. bd mol squash (create digest)\n3. Submit to merge queue\n4. gt handoff (request shutdown)\n5. Wait for Witness to kill session\n6. Witness removes worktree + branch</code></pre>\n</p>\n<h3>Session Cycling</h3>\n<p>\n<pre><code class=\"language-text\">1. Agent notices context filling\n2. gt handoff (sends mail to self)\n3. Manager kills session\n4. Manager starts new session\n5. New session reads handoff mail</code></pre>\n</p>\n<h2>Environment Variables</h2>\n<p>\nGas Town sets environment variables for each agent session via <code>config.AgentEnv()</code>.\nThese are set in tmux session environment when agents are spawned.\n</p>\n<h3>Core Variables (All Agents)</h3>\n<table><tr><td>Variable</td><td>Purpose</td><td>Example</td></tr>\n</table>\n<table><tr><td><code>GT_ROLE</code></td><td>Agent role type</td><td><code>mayor</code>, <code>witness</code>, <code>polecat</code>, <code>crew</code></td></tr>\n<tr><td><code>GT_ROOT</code></td><td>Town root directory</td><td><code>/home/user/gt</code></td></tr>\n<tr><td><code>BD_ACTOR</code></td><td>Agent identity for attribution</td><td><code>gastown/polecats/toast</code></td></tr>\n<tr><td><code>GIT_AUTHOR_NAME</code></td><td>Commit attribution (same as BD_ACTOR)</td><td><code>gastown/polecats/toast</code></td></tr>\n<tr><td><code>BEADS_DIR</code></td><td>Beads database location</td><td><code>/home/user/gt/gastown/.beads</code></td></tr>\n</table>\n<h3>Rig-Level Variables</h3>\n<table><tr><td>Variable</td><td>Purpose</td><td>Roles</td></tr>\n</table>\n<table><tr><td><code>GT_RIG</code></td><td>Rig name</td><td>witness, refinery, polecat, crew</td></tr>\n<tr><td><code>GT_POLECAT</code></td><td>Polecat worker name</td><td>polecat only</td></tr>\n<tr><td><code>GT_CREW</code></td><td>Crew worker name</td><td>crew only</td></tr>\n<tr><td><code>BEADS_AGENT_NAME</code></td><td>Agent name for beads operations</td><td>polecat, crew</td></tr>\n<tr><td><code>BEADS_NO_DAEMON</code></td><td>Disable beads daemon (isolated context)</td><td>polecat, crew</td></tr>\n</table>\n<h3>Other Variables</h3>\n<table><tr><td>Variable</td><td>Purpose</td></tr>\n</table>\n<table><tr><td><code>GIT_AUTHOR_EMAIL</code></td><td>Workspace owner email (from git config)</td></tr>\n<tr><td><code>GT_TOWN_ROOT</code></td><td>Override town root detection (manual use)</td></tr>\n<tr><td><code>CLAUDE_RUNTIME_CONFIG_DIR</code></td><td>Custom Claude settings directory</td></tr>\n</table>\n<h3>Environment by Role</h3>\n<table><tr><td>Role</td><td>Key Variables</td></tr>\n</table>\n<table><tr><td><strong>Mayor</strong></td><td><code>GT_ROLE=mayor</code>, <code>BD_ACTOR=mayor</code></td></tr>\n<tr><td><strong>Deacon</strong></td><td><code>GT_ROLE=deacon</code>, <code>BD_ACTOR=deacon</code></td></tr>\n<tr><td><strong>Boot</strong></td><td><code>GT_ROLE=boot</code>, <code>BD_ACTOR=deacon-boot</code></td></tr>\n<tr><td><strong>Witness</strong></td><td><code>GT_ROLE=witness</code>, <code>GT_RIG=&lt;rig&gt;</code>, <code>BD_ACTOR=&lt;rig&gt;/witness</code></td></tr>\n<tr><td><strong>Refinery</strong></td><td><code>GT_ROLE=refinery</code>, <code>GT_RIG=&lt;rig&gt;</code>, <code>BD_ACTOR=&lt;rig&gt;/refinery</code></td></tr>\n<tr><td><strong>Polecat</strong></td><td><code>GT_ROLE=polecat</code>, <code>GT_RIG=&lt;rig&gt;</code>, <code>GT_POLECAT=&lt;name&gt;</code>, <code>BD_ACTOR=&lt;rig&gt;/polecats/&lt;name&gt;</code></td></tr>\n<tr><td><strong>Crew</strong></td><td><code>GT_ROLE=crew</code>, <code>GT_RIG=&lt;rig&gt;</code>, <code>GT_CREW=&lt;name&gt;</code>, <code>BD_ACTOR=&lt;rig&gt;/crew/&lt;name&gt;</code></td></tr>\n</table>\n<h3>Doctor Check</h3>\n<p>\nThe <code>gt doctor</code> command verifies that running tmux sessions have correct\nenvironment variables. Mismatches are reported as warnings:\n</p>\n<p>\n<pre><code class=\"language-text\">âš  env-vars: Found 3 env var mismatch(es) across 1 session(s)\n    hq-mayor: missing GT_ROOT (expected &quot;/home/user/gt&quot;)</code></pre>\n</p>\n<p>\nFix by restarting sessions: <code>gt shutdown &amp;&amp; gt up</code>\n</p>\n<h2>Agent Working Directories and Settings</h2>\n<p>\nEach agent runs in a specific working directory and has its own Claude settings.\nUnderstanding this hierarchy is essential for proper configuration.\n</p>\n<h3>Working Directories by Role</h3>\n<table><tr><td>Role</td><td>Working Directory</td><td>Notes</td></tr>\n</table>\n<table><tr><td><strong>Mayor</strong></td><td><code>~/gt/mayor/</code></td><td>Town-level coordinator, isolated from rigs</td></tr>\n<tr><td><strong>Deacon</strong></td><td><code>~/gt/deacon/</code></td><td>Background supervisor daemon</td></tr>\n<tr><td><strong>Witness</strong></td><td><code>~/gt/&lt;rig&gt;/witness/</code></td><td>No git clone, monitors polecats only</td></tr>\n<tr><td><strong>Refinery</strong></td><td><code>~/gt/&lt;rig&gt;/refinery/rig/</code></td><td>Worktree on main branch</td></tr>\n<tr><td><strong>Crew</strong></td><td><code>~/gt/&lt;rig&gt;/crew/&lt;name&gt;/rig/</code></td><td>Persistent human workspace clone</td></tr>\n<tr><td><strong>Polecat</strong></td><td><code>~/gt/&lt;rig&gt;/polecats/&lt;name&gt;/rig/</code></td><td>Ephemeral worker worktree</td></tr>\n</table>\n<p>\nNote: The per-rig <code>&lt;rig&gt;/mayor/rig/</code> directory is NOT a working directoryâ€”it's\na git clone that holds the canonical <code>.beads/</code> database for that rig.\n</p>\n<h3>Settings File Locations</h3>\n<p>\nClaude Code searches for <code>.claude/settings.json</code> starting from the working\ndirectory and traversing upward. Settings are placed in <strong>parent directories</strong>\n(not inside git clones) so they're found via directory traversal without\npolluting source repositories:\n</p>\n<p>\n<pre><code class=\"language-text\">~/gt/\nâ”œâ”€â”€ mayor/.claude/settings.json          # Mayor settings\nâ”œâ”€â”€ deacon/.claude/settings.json         # Deacon settings\nâ””â”€â”€ &lt;rig&gt;/\n    â”œâ”€â”€ witness/.claude/settings.json    # Witness settings (no rig/ subdir)\n    â”œâ”€â”€ refinery/.claude/settings.json   # Found by refinery/rig/ via traversal\n    â”œâ”€â”€ crew/.claude/settings.json       # Shared by all crew/&lt;name&gt;/rig/\n    â””â”€â”€ polecats/.claude/settings.json   # Shared by all polecats/&lt;name&gt;/rig/</code></pre>\n</p>\n<strong>Why parent directories?</strong> Agents working in git clones (like <code>refinery/rig/</code>)\n<p>\nwould pollute the source repo if settings were placed there. By putting settings\none level up, Claude finds them via upward traversal, and all workers of the\nsame type share the same settings.\n</p>\n<h3>CLAUDE.md Locations</h3>\n<p>\nRole context is delivered via CLAUDE.md files or ephemeral injection:\n</p>\n<table><tr><td>Role</td><td>CLAUDE.md Location</td><td>Method</td></tr>\n</table>\n<table><tr><td><strong>Mayor</strong></td><td><code>~/gt/mayor/CLAUDE.md</code></td><td>On disk</td></tr>\n<tr><td><strong>Deacon</strong></td><td>(none)</td><td>Injected via <code>gt prime</code> at SessionStart</td></tr>\n<tr><td><strong>Witness</strong></td><td>(none)</td><td>Injected via <code>gt prime</code> at SessionStart</td></tr>\n<tr><td><strong>Refinery</strong></td><td><code>&lt;rig&gt;/refinery/rig/CLAUDE.md</code></td><td>On disk (inside worktree)</td></tr>\n<tr><td><strong>Crew</strong></td><td>(none)</td><td>Injected via <code>gt prime</code> at SessionStart</td></tr>\n<tr><td><strong>Polecat</strong></td><td>(none)</td><td>Injected via <code>gt prime</code> at SessionStart</td></tr>\n</table>\n<p>\nAdditionally, each rig has <code>&lt;rig&gt;/mayor/rig/CLAUDE.md</code> for the per-rig mayor clone\n(used for beads operations, not a running agent).\n</p>\n<strong>Why ephemeral injection?</strong> Writing CLAUDE.md into git clones would:\n<ol><li>Pollute source repos when agents commit/push</li>\n<li>Leak Gas Town internals into project history</li>\n<li>Conflict with project-specific CLAUDE.md files</li>\n</ol>\n<p>\nThe <code>gt prime</code> command runs at SessionStart hook and injects context without\npersisting it to disk.\n</p>\n<h3>Sparse Checkout (Source Repo Isolation)</h3>\n<p>\nWhen agents work on source repositories that have their own Claude Code configuration,\nGas Town uses git sparse checkout to exclude all context files:\n</p>\n<p>\n<pre><code class=\"language-bash\"># Automatically configured for worktrees - excludes:\n# - .claude/       : settings, rules, agents, commands\n# - CLAUDE.md      : primary context file\n# - CLAUDE.local.md: personal context file\n# - .mcp.json      : MCP server configuration\ngit sparse-checkout set --no-cone '/*' '!/.claude/' '!/CLAUDE.md' '!/CLAUDE.local.md' '!/.mcp.json'</code></pre>\n</p>\n<p>\nThis ensures agents use Gas Town's context, not the source repo's instructions.\n</p>\n<strong>Doctor check</strong>: <code>gt doctor</code> verifies sparse checkout is configured correctly.\n<p>\nRun <code>gt doctor --fix</code> to update legacy configurations missing the newer patterns.\n</p>\n<h3>Settings Inheritance</h3>\n<p>\nClaude Code's settings search order (first match wins):\n</p>\n<ol><li><code>.claude/settings.json</code> in current working directory</li>\n<li><code>.claude/settings.json</code> in parent directories (traversing up)</li>\n<li><code>~/.claude/settings.json</code> (user global settings)</li>\n</ol>\n<p>\nGas Town places settings at each agent's working directory root, so agents\nfind their role-specific settings before reaching any parent or global config.\n</p>\n<h3>Settings Templates</h3>\n<p>\nGas Town uses two settings templates based on role type:\n</p>\n<table><tr><td>Type</td><td>Roles</td><td>Key Difference</td></tr>\n</table>\n<table><tr><td><strong>Interactive</strong></td><td>Mayor, Crew</td><td>Mail injected on <code>UserPromptSubmit</code> hook</td></tr>\n<tr><td><strong>Autonomous</strong></td><td>Polecat, Witness, Refinery, Deacon</td><td>Mail injected on <code>SessionStart</code> hook</td></tr>\n</table>\n<p>\nAutonomous agents may start without user input, so they need mail checked\nat session start. Interactive agents wait for user prompts.\n</p>\n<h3>Troubleshooting</h3>\n<table><tr><td>Problem</td><td>Solution</td></tr>\n</table>\n<table><tr><td>Agent using wrong settings</td><td>Check <code>gt doctor</code>, verify sparse checkout</td></tr>\n<tr><td>Settings not found</td><td>Ensure <code>.claude/settings.json</code> exists at role home</td></tr>\n<tr><td>Source repo settings leaking</td><td>Run <code>gt doctor --fix</code> to configure sparse checkout</td></tr>\n<tr><td>Mayor settings affecting polecats</td><td>Mayor should run in <code>mayor/</code>, not town root</td></tr>\n</table>\n<h2>CLI Reference</h2>\n<h3>Town Management</h3>\n<p>\n<pre><code class=\"language-bash\">gt install [path]            # Create town\ngt install --git             # With git init\ngt doctor                    # Health check\ngt doctor --fix              # Auto-repair</code></pre>\n</p>\n<h3>Configuration</h3>\n<p>\n<pre><code class=\"language-bash\"># Agent management\ngt config agent list [--json]     # List all agents (built-in + custom)\ngt config agent get &lt;name&gt;        # Show agent configuration\ngt config agent set &lt;name&gt; &lt;cmd&gt;  # Create or update custom agent\ngt config agent remove &lt;name&gt;     # Remove custom agent (built-ins protected)\n\n# Default agent\ngt config default-agent [name]    # Get or set town default agent</code></pre>\n</p>\n<strong>Built-in agents</strong>: <code>claude</code>, <code>gemini</code>, <code>codex</code>, <code>cursor</code>, <code>auggie</code>, <code>amp</code>\n<strong>Custom agents</strong>: Define per-town via CLI or JSON:\n<p>\n<pre><code class=\"language-bash\">gt config agent set claude-glm &quot;claude-glm --model glm-4&quot;\ngt config agent set claude &quot;claude-opus&quot;  # Override built-in\ngt config default-agent claude-glm       # Set default</code></pre>\n</p>\n<strong>Advanced agent config</strong> (<code>settings/agents.json</code>):\n<p>\n<pre><code class=\"language-json\">{\n  &quot;version&quot;: 1,\n  &quot;agents&quot;: {\n    &quot;opencode&quot;: {\n      &quot;command&quot;: &quot;opencode&quot;,\n      &quot;args&quot;: [],\n      &quot;resume_flag&quot;: &quot;--session&quot;,\n      &quot;resume_style&quot;: &quot;flag&quot;,\n      &quot;non_interactive&quot;: {\n        &quot;subcommand&quot;: &quot;run&quot;,\n        &quot;output_flag&quot;: &quot;--format json&quot;\n      }\n    }\n  }\n}</code></pre>\n</p>\n<strong>Rig-level agents</strong> (<code>&lt;rig&gt;/settings/config.json</code>):\n<p>\n<pre><code class=\"language-json\">{\n  &quot;type&quot;: &quot;rig-settings&quot;,\n  &quot;version&quot;: 1,\n  &quot;agent&quot;: &quot;opencode&quot;,\n  &quot;agents&quot;: {\n    &quot;opencode&quot;: {\n      &quot;command&quot;: &quot;opencode&quot;,\n      &quot;args&quot;: [&quot;--session&quot;]\n    }\n  }\n}</code></pre>\n</p>\n<strong>Agent resolution order</strong>: rig-level â†’ town-level â†’ built-in presets.\n<p>\nFor OpenCode autonomous mode, set env var in your shell profile:\n<pre><code class=\"language-bash\">export OPENCODE_PERMISSION='{&quot;*&quot;:&quot;allow&quot;}'</code></pre>\n</p>\n<h3>Rig Management</h3>\n<p>\n<pre><code class=\"language-bash\">gt rig add &lt;name&gt; &lt;url&gt;\ngt rig list\ngt rig remove &lt;name&gt;</code></pre>\n</p>\n<h3>Convoy Management (Primary Dashboard)</h3>\n<p>\n<pre><code class=\"language-bash\">gt convoy list                          # Dashboard of active convoys\ngt convoy status [convoy-id]            # Show progress (ðŸšš hq-cv-*)\ngt convoy create &quot;name&quot; [issues...]     # Create convoy tracking issues\ngt convoy create &quot;name&quot; gt-a bd-b --notify mayor/  # With notification\ngt convoy list --all                    # Include landed convoys\ngt convoy list --status=closed          # Only landed convoys</code></pre>\n</p>\n<p>\nNote: \"Swarm\" is ephemeral (workers on a convoy's issues). See <a href=\"/docs/concepts/convoy\">Convoys</a>.\n</p>\n<h3>Work Assignment</h3>\n<p>\n<pre><code class=\"language-bash\"># Standard workflow: convoy first, then sling\ngt convoy create &quot;Feature X&quot; gt-abc gt-def\ngt sling gt-abc &lt;rig&gt;                    # Assign to polecat\ngt sling gt-abc &lt;rig&gt; --agent codex      # Override runtime for this sling/spawn\ngt sling &lt;proto&gt; --on gt-def &lt;rig&gt;       # With workflow template\n\n# Quick sling (auto-creates convoy)\ngt sling &lt;bead&gt; &lt;rig&gt;                    # Auto-convoy for dashboard visibility</code></pre>\n</p>\n<p>\nAgent overrides:\n</p>\n<ul><li><code>gt start --agent &lt;alias&gt;</code> overrides the Mayor/Deacon runtime for this launch.</li>\n<li><code>gt mayor start|attach|restart --agent &lt;alias&gt;</code> and <code>gt deacon start|attach|restart --agent &lt;alias&gt;</code> do the same.</li>\n<li><code>gt start crew &lt;name&gt; --agent &lt;alias&gt;</code> and <code>gt crew at &lt;name&gt; --agent &lt;alias&gt;</code> override the crew worker runtime.</li>\n</ul>\n<h3>Communication</h3>\n<p>\n<pre><code class=\"language-bash\">gt mail inbox\ngt mail read &lt;id&gt;\ngt mail send &lt;addr&gt; -s &quot;Subject&quot; -m &quot;Body&quot;\ngt mail send --human -s &quot;...&quot;    # To overseer</code></pre>\n</p>\n<h3>Escalation</h3>\n<p>\n<pre><code class=\"language-bash\">gt escalate &quot;topic&quot;              # Default: MEDIUM severity\ngt escalate -s CRITICAL &quot;msg&quot;    # Urgent, immediate attention\ngt escalate -s HIGH &quot;msg&quot;        # Important blocker\ngt escalate -s MEDIUM &quot;msg&quot; -m &quot;Details...&quot;</code></pre>\n</p>\n<p>\nSee <a href=\"/docs/design/escalation\">Escalation</a> for full protocol.\n</p>\n<h3>Sessions</h3>\n<p>\n<pre><code class=\"language-bash\">gt handoff                   # Request cycle (context-aware)\ngt handoff --shutdown        # Terminate (polecats)\ngt session stop &lt;rig&gt;/&lt;agent&gt;\ngt peek &lt;agent&gt;              # Check health\ngt nudge &lt;agent&gt; &quot;message&quot;   # Send message to agent\ngt seance                    # List discoverable predecessor sessions\ngt seance --talk &lt;id&gt;        # Talk to predecessor (full context)\ngt seance --talk &lt;id&gt; -p &quot;Where is X?&quot;  # One-shot question</code></pre>\n</p>\n<strong>Session Discovery</strong>: Each session has a startup nudge that becomes searchable\n<p>\nin Claude's <code>/resume</code> picker:\n</p>\n<p>\n<pre><code class=\"language-text\">[GAS TOWN] recipient &lt;- sender â€¢ timestamp â€¢ topic[:mol-id]</code></pre>\n</p>\n<p>\nExample: <code>[GAS TOWN] gastown/crew/gus &lt;- human â€¢ 2025-12-30T15:42 â€¢ restart</code>\n</p>\n<strong>IMPORTANT</strong>: Always use <code>gt nudge</code> to send messages to Claude sessions.\n<p>\nNever use raw <code>tmux send-keys</code> - it doesn't handle Claude's input correctly.\n<code>gt nudge</code> uses literal mode + debounce + separate Enter for reliable delivery.\n</p>\n<h3>Emergency</h3>\n<p>\n<pre><code class=\"language-bash\">gt stop --all                # Kill all sessions\ngt stop --rig &lt;name&gt;         # Kill rig sessions</code></pre>\n</p>\n<h2>Beads Commands (bd)</h2>\n<p>\n<pre><code class=\"language-bash\">bd ready                     # Work with no blockers\nbd list --status=open\nbd list --status=in_progress\nbd show &lt;id&gt;\nbd create --title=&quot;...&quot; --type=task\nbd update &lt;id&gt; --status=in_progress\nbd close &lt;id&gt;\nbd dep add &lt;child&gt; &lt;parent&gt;  # child depends on parent\nbd sync                      # Push/pull changes</code></pre>\n</p>\n<h2>Patrol Agents</h2>\n<p>\nDeacon, Witness, and Refinery run continuous patrol loops using wisps:\n</p>\n<table><tr><td>Agent</td><td>Patrol Molecule</td><td>Responsibility</td></tr>\n</table>\n<table><tr><td><strong>Deacon</strong></td><td><code>mol-deacon-patrol</code></td><td>Agent lifecycle, plugin execution, health checks</td></tr>\n<tr><td><strong>Witness</strong></td><td><code>mol-witness-patrol</code></td><td>Monitor polecats, nudge stuck workers</td></tr>\n<tr><td><strong>Refinery</strong></td><td><code>mol-refinery-patrol</code></td><td>Process merge queue, review MRs</td></tr>\n</table>\n<p>\n<pre><code class=\"language-text\">1. bd mol wisp mol-&lt;role&gt;-patrol\n2. Execute steps (check workers, process queue, run plugins)\n3. bd mol squash (or burn if routine)\n4. Loop</code></pre>\n</p>\n<h2>Plugin Molecules</h2>\n<p>\nPlugins are molecules with specific labels:\n</p>\n<p>\n<pre><code class=\"language-json\">{\n  &quot;id&quot;: &quot;mol-security-scan&quot;,\n  &quot;labels&quot;: [&quot;template&quot;, &quot;plugin&quot;, &quot;witness&quot;, &quot;tier:haiku&quot;]\n}</code></pre>\n</p>\n<p>\nPatrol molecules bond plugins dynamically:\n</p>\n<p>\n<pre><code class=\"language-bash\">bd mol bond mol-security-scan $PATROL_ID --var scope=&quot;$SCOPE&quot;</code></pre>\n</p>\n<h2>Common Issues</h2>\n<table><tr><td>Problem</td><td>Solution</td></tr>\n</table>\n<table><tr><td>Agent in wrong directory</td><td>Check cwd, <code>gt doctor</code></td></tr>\n<tr><td>Beads prefix mismatch</td><td>Check <code>bd show</code> vs rig config</td></tr>\n<tr><td>Worktree conflicts</td><td>Ensure <code>BEADS_NO_DAEMON=1</code> for polecats</td></tr>\n<tr><td>Stuck worker</td><td><code>gt nudge</code>, then <code>gt peek</code></td></tr>\n<tr><td>Dirty git state</td><td>Commit or discard, then <code>gt handoff</code></td></tr>\n</table>\n<h2>Architecture Notes</h2>\n<strong>Bare repo pattern</strong>: <code>.repo.git/</code> is bare (no working dir). Refinery and polecats are worktrees sharing refs. Polecat branches visible to refinery immediately.\n<strong>Beads as control plane</strong>: No separate orchestrator. Molecule steps ARE beads issues. State transitions are git commits.\n<strong>Nondeterministic idempotence</strong>: Any worker can continue any molecule. Steps are atomic checkpoints in beads.\n<strong>Convoy tracking</strong>: Convoys track batched work across rigs. A \"swarm\" is ephemeral - just the workers currently on a convoy's issues. See <a href=\"/docs/concepts/convoy\">Convoys</a> for details.";
---

<DocsLayout title="Gas Town Reference" description="Technical reference for Gas Town internals. Read the README first.">
  <div class="markdown-content" set:html={content} />
</DocsLayout>
