---
import DocsLayout from '../../../layouts/DocsLayout.astro';

const content = "<p>\nMolecules are workflow templates that coordinate multi-step work in Gas Town.\n</p>\n<h2>Molecule Lifecycle</h2>\n<p>\n<pre><code class=\"language-text\">Formula (source TOML) ─── &quot;Ice-9&quot;\n    │\n    ▼ bd cook\nProtomolecule (frozen template) ─── Solid\n    │\n    ├─▶ bd mol pour ──▶ Mol (persistent) ─── Liquid ──▶ bd squash ──▶ Digest\n    │\n    └─▶ bd mol wisp ──▶ Wisp (ephemeral) ─── Vapor ──┬▶ bd squash ──▶ Digest\n                                                     └▶ bd burn ──▶ (gone)</code></pre>\n</p>\n<h2>Core Concepts</h2>\n<table><tr><td>Term</td><td>Description</td></tr>\n</table>\n<table><tr><td><strong>Formula</strong></td><td>Source TOML template defining workflow steps</td></tr>\n<tr><td><strong>Protomolecule</strong></td><td>Frozen template ready for instantiation</td></tr>\n<tr><td><strong>Molecule</strong></td><td>Active workflow instance with trackable steps</td></tr>\n<tr><td><strong>Wisp</strong></td><td>Ephemeral molecule for patrol cycles (never synced)</td></tr>\n<tr><td><strong>Digest</strong></td><td>Squashed summary of completed molecule</td></tr>\n<tr><td><strong>Shiny Workflow</strong></td><td>Canonical polecat formula: design → implement → review → test → submit</td></tr>\n</table>\n<h2>Common Mistake: Reading Formulas Directly</h2>\n<strong>WRONG:</strong>\n<p>\n<pre><code class=\"language-bash\"># Reading a formula file and manually creating beads for each step\ncat .beads/formulas/mol-polecat-work.formula.toml\nbd create --title &quot;Step 1: Load context&quot; --type task\nbd create --title &quot;Step 2: Branch setup&quot; --type task\n# ... creating beads from formula prose</code></pre>\n</p>\n<strong>RIGHT:</strong>\n<p>\n<pre><code class=\"language-bash\"># Cook the formula into a proto, pour into a molecule\nbd cook mol-polecat-work\nbd mol pour mol-polecat-work --var issue=gt-xyz\n# Now work through the step beads that were created\nbd ready                    # Find next step\nbd close &lt;step-id&gt;          # Complete it</code></pre>\n</p>\n<strong>Key insight:</strong> Formulas are source templates (like source code). You never read\n<p>\nthem directly during work. The <code>cook</code> → <code>pour</code> pipeline creates step beads for you.\nYour molecule already has steps - use <code>bd ready</code> to find them.\n</p>\n<h2>Navigating Molecules</h2>\n<p>\nMolecules help you track where you are in multi-step workflows.\n</p>\n<h3>Finding Your Place</h3>\n<p>\n<pre><code class=\"language-bash\">bd mol current              # Where am I?\nbd mol current gt-abc       # Status of specific molecule</code></pre>\n</p>\n<p>\nOutput:\n<pre><code class=\"language-text\">You're working on molecule gt-abc (Feature X)\n\n  ✓ gt-abc.1: Design\n  ✓ gt-abc.2: Scaffold\n  ✓ gt-abc.3: Implement\n  → gt-abc.4: Write tests [in_progress] &lt;- YOU ARE HERE\n  ○ gt-abc.5: Documentation\n  ○ gt-abc.6: Exit decision\n\nProgress: 3/6 steps complete</code></pre>\n</p>\n<h3>Seamless Transitions</h3>\n<p>\nClose a step and advance in one command:\n</p>\n<p>\n<pre><code class=\"language-bash\">bd close gt-abc.3 --continue   # Close and advance to next step\nbd close gt-abc.3 --no-auto    # Close but don't auto-claim next</code></pre>\n</p>\n<strong>The old way (3 commands):</strong>\n<p>\n<pre><code class=\"language-bash\">bd close gt-abc.3\nbd ready --parent=gt-abc\nbd update gt-abc.4 --status=in_progress</code></pre>\n</p>\n<strong>The new way (1 command):</strong>\n<p>\n<pre><code class=\"language-bash\">bd close gt-abc.3 --continue</code></pre>\n</p>\n<h3>Transition Output</h3>\n<p>\n<pre><code class=\"language-text\">✓ Closed gt-abc.3: Implement feature\n\nNext ready in molecule:\n  gt-abc.4: Write tests\n\n→ Marked in_progress (use --no-auto to skip)</code></pre>\n</p>\n<h3>When Molecule Completes</h3>\n<p>\n<pre><code class=\"language-text\">✓ Closed gt-abc.6: Exit decision\n\nMolecule gt-abc complete! All steps closed.\nConsider: bd mol squash gt-abc --summary '...'</code></pre>\n</p>\n<h2>Molecule Commands</h2>\n<h3>Beads Operations (bd)</h3>\n<p>\n<pre><code class=\"language-bash\"># Formulas\nbd formula list              # Available formulas\nbd formula show &lt;name&gt;       # Formula details\nbd cook &lt;formula&gt;            # Formula → Proto\n\n# Molecules (data operations)\nbd mol list                  # Available protos\nbd mol show &lt;id&gt;             # Proto details\nbd mol pour &lt;proto&gt;          # Create mol\nbd mol wisp &lt;proto&gt;          # Create wisp\nbd mol bond &lt;proto&gt; &lt;parent&gt; # Attach to existing mol\nbd mol squash &lt;id&gt;           # Condense to digest\nbd mol burn &lt;id&gt;             # Discard wisp\nbd mol current               # Where am I in the current molecule?</code></pre>\n</p>\n<h3>Agent Operations (gt)</h3>\n<p>\n<pre><code class=\"language-bash\"># Hook management\ngt hook                    # What's on MY hook\ngt mol current               # What should I work on next\ngt mol progress &lt;id&gt;         # Execution progress of molecule\ngt mol attach &lt;bead&gt; &lt;mol&gt;   # Pin molecule to bead\ngt mol detach &lt;bead&gt;         # Unpin molecule from bead\n\n# Agent lifecycle\ngt mol burn                  # Burn attached molecule\ngt mol squash                # Squash attached molecule\ngt mol step done &lt;step&gt;      # Complete a molecule step</code></pre>\n</p>\n<h2>Polecat Workflow</h2>\n<p>\nPolecats receive work via their hook - a pinned molecule attached to an issue.\nThey execute molecule steps sequentially, closing each step as they complete it.\n</p>\n<h3>Molecule Types for Polecats</h3>\n<table><tr><td>Type</td><td>Storage</td><td>Use Case</td></tr>\n</table>\n<table><tr><td><strong>Regular Molecule</strong></td><td><code>.beads/</code> (synced)</td><td>Discrete deliverables, audit trail</td></tr>\n<tr><td><strong>Wisp</strong></td><td><code>.beads/</code> (ephemeral)</td><td>Patrol cycles, operational loops</td></tr>\n</table>\n<p>\nPolecats typically use <strong>regular molecules</strong> because each assignment has audit value.\nPatrol agents (Witness, Refinery, Deacon) use <strong>wisps</strong> to prevent accumulation.\n</p>\n<h3>Hook Management</h3>\n<p>\n<pre><code class=\"language-bash\">gt hook                        # What's on MY hook?\ngt mol attach-from-mail &lt;id&gt;   # Attach work from mail message\ngt done                        # Signal completion (syncs, submits to MQ, notifies Witness)</code></pre>\n</p>\n<h3>Polecat Workflow Summary</h3>\n<p>\n<pre><code class=\"language-text\">1. Spawn with work on hook\n2. gt hook                 # What's hooked?\n3. bd mol current          # Where am I?\n4. Execute current step\n5. bd close &lt;step&gt; --continue\n6. If more steps: GOTO 3\n7. gt done                 # Signal completion</code></pre>\n</p>\n<h3>Wisp vs Molecule Decision</h3>\n<table><tr><td>Question</td><td>Molecule</td><td>Wisp</td></tr>\n</table>\n<table><tr><td>Does it need audit trail?</td><td>Yes</td><td>No</td></tr>\n<tr><td>Will it repeat continuously?</td><td>No</td><td>Yes</td></tr>\n<tr><td>Is it discrete deliverable?</td><td>Yes</td><td>No</td></tr>\n<tr><td>Is it operational routine?</td><td>No</td><td>Yes</td></tr>\n</table>\n<h2>Best Practices</h2>\n<ol><li><strong>CRITICAL: Close steps in real-time</strong> - Mark <code>in_progress</code> BEFORE starting, <code>closed</code> IMMEDIATELY after completing. Never batch-close steps at the end. Molecules ARE the ledger - each step closure is a timestamped CV entry. Batch-closing corrupts the timeline and violates HOP's core promise.</li>\n<li><strong>Use <code>--continue</code> for propulsion</strong> - Keep momentum by auto-advancing</li>\n<li><strong>Check progress with <code>bd mol current</code></strong> - Know where you are before resuming</li>\n<li><strong>Squash completed molecules</strong> - Create digests for audit trail</li>\n<li><strong>Burn routine wisps</strong> - Don't accumulate ephemeral patrol data</li></ol>";
---

<DocsLayout title="Molecules" description="Molecules are workflow templates that coordinate multi-step work in Gas Town.">
  <div class="markdown-content" set:html={content} />
</DocsLayout>
